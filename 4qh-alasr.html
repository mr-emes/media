<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Pembelajaran Al-Quran Hadits</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;500;600;700&display=swap');
        
        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.5rem;
            line-height: 1.8;
            text-align: center;
            direction: rtl;
        }
        
        @media (min-width: 768px) {
            .arabic-text {
                font-size: 2.5rem;
                line-height: 2;
            }
        }
        
        .canvas-container {
            border: 3px dashed #3b82f6;
            border-radius: 16px;
            background: #ffffff;
        }
        
        .certificate {
            background: linear-gradient(135deg, #fef7cd 0%, #fef3c7 25%, #fed7aa 50%, #fde68a 75%, #fef7cd 100%);
            border: 12px solid #fbbf24;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .certificate::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 4px solid #fcd34d;
            border-radius: 12px;
            pointer-events: none;
        }
        
        .ornament-corner {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #fbbf24 30%, transparent 30%);
        }
        
        .game-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }
        
        .game-card:hover::before {
            left: 100%;
        }
        
        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .correct {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            color: white !important;
            animation: correctPulse 0.6s ease-in-out;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            color: white !important;
            animation: incorrectShake 0.6s ease-in-out;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); }
            100% { transform: scale(1); }
        }
        
        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-spin-slow {
            animation: spin-slow 3s linear infinite;
        }
        
        .game-option {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 3px solid transparent;
            background-clip: padding-box;
            position: relative;
        }
        
        .game-option::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 3px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
            border-radius: inherit;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .game-option:hover::before {
            opacity: 1;
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen font-['Inter']">
    <!-- Header dengan Info Siswa -->
    <header class="bg-white shadow-xl border-b-4 border-blue-600">
        <div class="container mx-auto px-3 py-3">
            <!-- Mobile Layout -->
            <div class="block md:hidden">
                <!-- Top Row: Logo + App Info -->
                <div class="flex items-center space-x-3 mb-3">
                    <div class="w-12 h-12 rounded-full overflow-hidden shadow-lg border-2 border-blue-200">
                        <img src="https://i.imgur.com/0Laf7Zu.png" alt="Logo Media Pembelajaran" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-1">
                        <h1 class="text-sm font-medium text-gray-600">Media Pembelajaran</h1>
                        <p class="text-lg font-bold text-blue-700">Al-Qur'an Hadits</p>
                        <p class="text-xs text-gray-600">Surah Al-Ashr ‚Ä¢ Kelas 4</p>
                        <p class="text-xs text-gray-500 mt-1">MAHFUD SIDIK, S.Pd.I</p>
                    </div>
                </div>
                
                <!-- Student Info Row -->
                <div id="studentInfoMobile" class="hidden bg-gradient-to-r from-green-50 to-emerald-50 px-4 py-3 rounded-xl border-2 border-green-200 mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <p class="text-sm font-bold text-gray-800" id="studentNameMobile"></p>
                            <p class="text-xs text-green-600 font-medium" id="studentClassMobile"></p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-600">Progress</p>
                            <p class="text-lg font-bold text-green-700"><span id="progressPercentageMobile">0</span>%</p>
                        </div>
                    </div>
                    <div class="bg-gray-200 rounded-full h-2 mb-2">
                        <div id="overallProgressMobile" class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div class="grid grid-cols-4 gap-1">
                        <div class="text-center">
                            <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center mx-auto">
                                <span class="text-xs" id="materiProgressMobile">üìö</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">Materi</p>
                        </div>
                        <div class="text-center">
                            <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center mx-auto">
                                <span class="text-xs" id="videoProgressMobile">üé•</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">Video</p>
                        </div>
                        <div class="text-center">
                            <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center mx-auto">
                                <span class="text-xs" id="gameProgressMobile">üéÆ</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">Game</p>
                        </div>
                        <div class="text-center">
                            <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center mx-auto">
                                <span class="text-xs" id="latihanProgressMobile">‚úçÔ∏è</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">Latihan</p>
                        </div>
                    </div>
                </div>
                

            </div>
            
            <!-- Desktop Layout -->
            <div class="hidden md:flex items-center justify-between">
                <!-- Logo dan Info Aplikasi -->
                <div class="flex items-center space-x-6">
                    <div class="w-20 h-20 rounded-full overflow-hidden shadow-lg border-4 border-blue-200">
                        <img src="https://i.imgur.com/0Laf7Zu.png" alt="Logo Media Pembelajaran" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h1 class="text-lg font-medium text-gray-600">Media Pembelajaran</h1>
                        <p class="text-3xl font-bold text-blue-700">Al-Qur'an Hadits</p>
                        <p class="text-sm text-gray-600">Surah Al-Ashr ‚Ä¢ Kelas 4</p>
                        <p class="text-sm text-gray-500 mt-2">MAHFUD SIDIK, S.Pd.I</p>
                    </div>
                </div>



                <!-- Info Siswa dan Progress -->
                <div id="studentInfo" class="text-right hidden">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 rounded-xl border-2 border-green-200 min-w-64">
                        <div class="mb-3">
                            <p class="text-lg font-bold text-gray-800" id="studentName"></p>
                            <p class="text-green-600 font-medium" id="studentClass"></p>
                        </div>
                        
                        <!-- Progress Section -->
                        <div class="border-t border-green-200 pt-3">
                            <p class="text-sm text-gray-600 mb-2">Progress Pembelajaran</p>
                            <div class="grid grid-cols-4 gap-2">
                                <div class="text-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mx-auto mb-1">
                                        <span class="text-sm" id="materiProgress">üìö</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Materi</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mx-auto mb-1">
                                        <span class="text-sm" id="videoProgress">üé•</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Video</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mx-auto mb-1">
                                        <span class="text-sm" id="gameProgress">üéÆ</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Game</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mx-auto mb-1">
                                        <span class="text-sm" id="latihanProgress">‚úçÔ∏è</span>
                                    </div>
                                    <p class="text-xs text-gray-600">Latihan</p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="bg-gray-200 rounded-full h-2">
                                    <div id="overallProgress" class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1 text-center">
                                    <span id="progressPercentage">0</span>% Selesai
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Form Input Nama Siswa -->
    <div id="loginForm" class="container mx-auto px-4 py-6 md:py-12">
        <div class="max-w-lg mx-auto bg-white rounded-3xl shadow-2xl p-6 md:p-10">
            <div class="text-center mb-8 md:mb-10">
                <div class="w-16 h-16 md:w-24 md:h-24 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6">
                    <span class="text-3xl md:text-5xl">üë®‚Äçüéì</span>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 md:mb-3">Selamat Datang!</h2>
                <p class="text-gray-600 text-base md:text-lg">Masukkan data diri untuk memulai pembelajaran</p>
            </div>
            
            <form id="studentForm" class="space-y-6 md:space-y-8">
                <div>
                    <label class="block text-base md:text-lg font-semibold text-gray-800 mb-2 md:mb-3">Nama Lengkap</label>
                    <input type="text" id="nameInput" required 
                           class="w-full px-4 py-3 md:px-6 md:py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 text-base md:text-lg"
                           placeholder="Masukkan nama lengkap">
                </div>
                
                <div>
                    <label class="block text-base md:text-lg font-semibold text-gray-800 mb-2 md:mb-3">Kelas</label>
                    <select id="classInput" required 
                            class="w-full px-4 py-3 md:px-6 md:py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-500 text-base md:text-lg">
                        <option value="">Pilih Kelas</option>
                        <option value="4A">4A</option>
                        <option value="4B">4B</option>
                        <option value="4C">4C</option>
                    </select>
                </div>
                
                <button type="submit" 
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 md:py-4 px-6 md:px-8 rounded-xl font-bold text-base md:text-lg hover:from-blue-700 hover:to-indigo-700 transition duration-300 shadow-lg">
                    üöÄ Mulai Belajar
                </button>
            </form>
        </div>
    </div>

    <!-- Konten Pembelajaran -->
    <div id="learningContent" class="hidden">
        <div class="container mx-auto px-3 md:px-6 py-4 md:py-8">
            <!-- Tab Navigation -->
            <div class="bg-white rounded-2xl md:rounded-3xl p-2 md:p-3 shadow-xl mb-6 md:mb-10">
                <!-- Mobile: Grid Layout -->
                <div class="grid grid-cols-2 gap-2 md:hidden">
                    <button onclick="showTab('materi')" id="tab-materi" 
                            class="tab-btn px-3 py-3 rounded-xl font-bold text-sm transition duration-300 bg-blue-600 text-white shadow-lg hover:bg-blue-700">
                        üìö Materi
                    </button>
                    <button onclick="showTab('video')" id="tab-video" 
                            class="tab-btn px-3 py-3 rounded-xl font-bold text-sm transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        üé• Video
                    </button>
                    <button onclick="showTab('game')" id="tab-game" 
                            class="tab-btn px-3 py-3 rounded-xl font-bold text-sm transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        üéÆ Game
                    </button>
                    <button onclick="showTab('latihan')" id="tab-latihan" 
                            class="tab-btn px-3 py-3 rounded-xl font-bold text-sm transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        ‚úçÔ∏è Latihan
                    </button>
                </div>
                
                <!-- Mobile: Second Row -->
                <div class="mt-2 md:hidden">
                    <button onclick="showTab('sertifikat')" id="tab-sertifikat" 
                            class="tab-btn w-full px-3 py-3 rounded-xl font-bold text-sm transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        üèÜ Sertifikat
                    </button>
                </div>
                
                <!-- Desktop: Flex Layout -->
                <div class="hidden md:flex flex-wrap justify-center">
                    <button onclick="showTab('materi')" id="tab-materi-desktop" 
                            class="tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 bg-blue-600 text-white shadow-lg hover:bg-blue-700">
                        üìö Materi
                    </button>
                    <button onclick="showTab('video')" id="tab-video-desktop" 
                            class="tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        üé• Video
                    </button>
                    <button onclick="showTab('game')" id="tab-game-desktop" 
                            class="tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        üéÆ Game
                    </button>
                    <button onclick="showTab('latihan')" id="tab-latihan-desktop" 
                            class="tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        ‚úçÔ∏è Latihan
                    </button>
                    <button onclick="showTab('sertifikat')" id="tab-sertifikat-desktop" 
                            class="tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                        üèÜ Sertifikat
                    </button>
                </div>
            </div>

            <!-- Tab Materi -->
            <div id="content-materi" class="tab-content">
                <div class="bg-white rounded-2xl md:rounded-3xl shadow-2xl p-4 md:p-10 mb-6 md:mb-8">
                    <h2 class="text-xl md:text-3xl font-bold text-center text-gray-800 mb-6 md:mb-10">ÿ≥ŸèŸàÿ±Ÿéÿ©Ÿè ÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê</h2>
                    
                    <!-- Bismillah -->
                    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl md:rounded-3xl p-4 md:p-8 mb-6 md:mb-10 border-2 border-emerald-200">
                        <div class="arabic-text text-center text-xl md:text-3xl text-emerald-800 mb-3 md:mb-4">
                            ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê
                        </div>
                        <p class="text-center text-emerald-700 font-semibold text-base md:text-lg">Bismillahir rahmanir rahiim</p>
                        <p class="text-center text-emerald-600 mt-2 text-sm md:text-base">Dengan menyebut nama Allah Yang Maha Pemurah lagi Maha Penyayang</p>
                    </div>

                    <!-- Ayat-ayat -->
                    <div class="space-y-4 md:space-y-8">
                        <!-- Ayat 1 -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl md:rounded-3xl p-4 md:p-8 border-2 border-blue-200">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 items-center">
                                <div class="text-center">
                                    <div class="arabic-text text-2xl md:text-4xl text-blue-800 mb-3 md:mb-4">ŸàŸéÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê Ô¥øŸ°Ô¥æ</div>
                                    <p class="text-blue-700 font-bold text-base md:text-lg mb-2">Wal 'ashr</p>
                                    <p class="text-blue-600 text-sm md:text-base">Demi masa</p>
                                </div>
                                <div class="bg-white rounded-xl md:rounded-2xl p-4 md:p-6 shadow-lg">
                                    <h4 class="font-bold text-gray-800 mb-3 md:mb-4 text-lg md:text-xl">Arti Per Kata:</h4>
                                    <div class="space-y-2 md:space-y-3">
                                        <div class="flex justify-between items-center p-2 md:p-3 bg-blue-50 rounded-lg md:rounded-xl">
                                            <span class="arabic-text text-lg md:text-2xl text-blue-800">ŸàŸé</span>
                                            <span class="text-blue-700 font-semibold text-sm md:text-base">wa = dan/demi</span>
                                        </div>
                                        <div class="flex justify-between items-center p-2 md:p-3 bg-blue-50 rounded-lg md:rounded-xl">
                                            <span class="arabic-text text-lg md:text-2xl text-blue-800">ÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê</span>
                                            <span class="text-blue-700 font-semibold text-sm md:text-base">al-'ashr = masa/waktu</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ayat 2 -->
                        <div class="bg-gradient-to-r from-purple-50 to-violet-50 rounded-3xl p-8 border-2 border-purple-200">
                            <div class="grid md:grid-cols-2 gap-8 items-center">
                                <div class="text-center">
                                    <div class="arabic-text text-2xl md:text-3xl text-purple-800 mb-4">ÿ•ŸêŸÜŸéŸë ÿßŸÑŸíÿ•ŸêŸÜÿ≥ŸéÿßŸÜŸé ŸÑŸéŸÅŸêŸä ÿÆŸèÿ≥Ÿíÿ±Ÿç Ô¥øŸ¢Ô¥æ</div>
                                    <p class="text-purple-700 font-bold text-base md:text-lg mb-2">Innal insaana lafii khusr</p>
                                    <p class="text-purple-600 text-sm md:text-base">Sesungguhnya manusia itu benar-benar dalam kerugian</p>
                                </div>
                                <div class="bg-white rounded-2xl p-6 shadow-lg">
                                    <h4 class="font-bold text-gray-800 mb-4 text-xl">Arti Per Kata:</h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center p-3 bg-purple-50 rounded-xl">
                                            <span class="arabic-text text-2xl text-purple-800">ÿ•ŸêŸÜŸéŸë</span>
                                            <span class="text-purple-700 font-semibold">inna = sesungguhnya</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-purple-50 rounded-xl">
                                            <span class="arabic-text text-2xl text-purple-800">ÿßŸÑŸíÿ•ŸêŸÜÿ≥ŸéÿßŸÜŸé</span>
                                            <span class="text-purple-700 font-semibold">al-insaana = manusia</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-purple-50 rounded-xl">
                                            <span class="arabic-text text-2xl text-purple-800">ŸÑŸéŸÅŸêŸä</span>
                                            <span class="text-purple-700 font-semibold">lafii = benar-benar dalam</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-purple-50 rounded-xl">
                                            <span class="arabic-text text-2xl text-purple-800">ÿÆŸèÿ≥Ÿíÿ±Ÿç</span>
                                            <span class="text-purple-700 font-semibold">khusr = kerugian</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ayat 3 -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-3xl p-8 border-2 border-green-200">
                            <div class="text-center mb-6">
                                <div class="arabic-text text-xl md:text-2xl text-green-800 mb-4">ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß ŸàŸéÿπŸéŸÖŸêŸÑŸèŸàÿß ÿßŸÑÿµŸéŸëÿßŸÑŸêÿ≠Ÿéÿßÿ™Ÿê ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß ÿ®ŸêÿßŸÑŸíÿ≠ŸéŸÇŸêŸë ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê Ô¥øŸ£Ô¥æ</div>
                                <p class="text-green-700 font-bold text-base md:text-lg mb-2">Illalladziina aamanuu wa 'amilus shaalihaati wa tawaashau bil haqqi wa tawaashau bish shabr</p>
                                <p class="text-green-600 text-sm md:text-base">Kecuali orang-orang yang beriman dan mengerjakan amal saleh dan nasehat menasehati supaya mentaati kebenaran dan nasehat menasehati supaya menetapi kesabaran</p>
                            </div>
                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <h4 class="font-bold text-gray-800 mb-4 text-xl">Arti Per Kata:</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ÿ•ŸêŸÑŸéŸëÿß</span>
                                            <span class="text-green-700 font-semibold">illa = kecuali</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé</span>
                                            <span class="text-green-700 font-semibold">alladziina = orang-orang yang</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ÿ¢ŸÖŸéŸÜŸèŸàÿß</span>
                                            <span class="text-green-700 font-semibold">aamanuu = beriman</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ŸàŸéÿπŸéŸÖŸêŸÑŸèŸàÿß</span>
                                            <span class="text-green-700 font-semibold">wa 'amiluu = dan mengerjakan</span>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ÿßŸÑÿµŸéŸëÿßŸÑŸêÿ≠Ÿéÿßÿ™Ÿê</span>
                                            <span class="text-green-700 font-semibold">ash-shaalihaati = amal saleh</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß</span>
                                            <span class="text-green-700 font-semibold">wa tawaashau = dan saling menasehati</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ÿ®ŸêÿßŸÑŸíÿ≠ŸéŸÇŸêŸë</span>
                                            <span class="text-green-700 font-semibold">bil haqqi = dengan kebenaran</span>
                                        </div>
                                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                            <span class="arabic-text text-xl text-green-800">ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê</span>
                                            <span class="text-green-700 font-semibold">bish shabri = dengan kesabaran</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pelajaran -->
                    <div class="mt-10 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-3xl p-8 border-2 border-yellow-200">
                        <h3 class="text-2xl font-bold text-orange-800 mb-6 text-center">üí° Pelajaran dari Surah Al-Ashr</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <div class="flex items-center mb-4">
                                    <span class="text-3xl mr-4">‚è∞</span>
                                    <h4 class="font-bold text-gray-800 text-lg">Waktu Sangat Berharga</h4>
                                </div>
                                <p class="text-gray-700">Jangan sia-siakan waktu yang telah Allah berikan kepada kita</p>
                            </div>
                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <div class="flex items-center mb-4">
                                    <span class="text-3xl mr-4">ü§≤</span>
                                    <h4 class="font-bold text-gray-800 text-lg">Beriman dan Beramal Saleh</h4>
                                </div>
                                <p class="text-gray-700">Manusia akan rugi jika tidak beriman dan beramal saleh</p>
                            </div>
                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <div class="flex items-center mb-4">
                                    <span class="text-3xl mr-4">ü§ù</span>
                                    <h4 class="font-bold text-gray-800 text-lg">Saling Menasehati</h4>
                                </div>
                                <p class="text-gray-700">Pentingnya saling menasehati dalam kebaikan dan kebenaran</p>
                            </div>
                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <div class="flex items-center mb-4">
                                    <span class="text-3xl mr-4">üí™</span>
                                    <h4 class="font-bold text-gray-800 text-lg">Sabar adalah Kunci</h4>
                                </div>
                                <p class="text-gray-700">Sabar adalah kunci kesuksesan dalam hidup</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tombol SAYA PAHAM -->
                    <div class="mt-10 text-center">
                        <div id="materiCompleteSection" class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-3xl p-8 border-2 border-green-200">
                            <h3 class="text-2xl font-bold text-green-800 mb-4">üìö Selesaikan Bagian Materi</h3>
                            <p class="text-green-700 mb-6 text-lg">Setelah membaca dan memahami semua materi di atas, klik tombol di bawah untuk menandai bahwa Anda sudah paham:</p>
                            
                            <button id="materiPahamBtn" onclick="markMateriComplete()" 
                                    class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-12 py-6 rounded-2xl font-bold text-2xl hover:from-green-700 hover:to-emerald-700 transition duration-300 shadow-2xl transform hover:scale-105">
                                ‚úÖ SAYA PAHAM
                            </button>
                            
                            <div id="materiCompleteMessage" class="hidden mt-6 bg-white rounded-2xl p-6 shadow-lg border-2 border-green-300">
                                <div class="flex items-center justify-center space-x-4">
                                    <span class="text-4xl">üéâ</span>
                                    <div>
                                        <h4 class="text-xl font-bold text-green-800">Bagian Materi Selesai!</h4>
                                        <p class="text-green-700">Anda telah menyelesaikan pembelajaran materi Surah Al-Ashr</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Video -->
            <div id="content-video" class="tab-content hidden">
                <div class="bg-white rounded-3xl shadow-2xl p-10">
                    <h2 class="text-3xl font-bold text-center text-gray-800 mb-10">üé• Video Pembelajaran Metode Ummi</h2>
                    
                    <div class="max-w-4xl mx-auto">
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-3xl p-8 border-2 border-red-200">
                            <div class="aspect-video rounded-2xl overflow-hidden shadow-2xl mb-8">
                                <iframe 
                                    id="youtubeVideo"
                                    width="100%" 
                                    height="100%" 
                                    src="https://www.youtube.com/embed/YFx5aGlf7AE?enablejsapi=1&origin=https://canva.com&rel=0&modestbranding=1&playsinline=1&controls=1&showinfo=0&fs=1&cc_load_policy=0&iv_load_policy=3&autohide=1" 
                                    title="Belajar Surah Al-Ashr dengan Metode Ummi" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" 
                                    referrerpolicy="strict-origin-when-cross-origin" 
                                    allowfullscreen
                                    sandbox="allow-scripts allow-same-origin allow-presentation allow-popups allow-popups-to-escape-sandbox"
                                    class="rounded-2xl">
                                </iframe>
                                
                                <!-- Fallback jika video tidak bisa dimuat -->
                                <div id="videoFallback" class="hidden bg-gradient-to-r from-blue-100 to-indigo-100 rounded-2xl p-8 text-center border-2 border-blue-300">
                                    <div class="mb-6">
                                        <span class="text-6xl mb-4 block">üì∫</span>
                                        <h4 class="text-2xl font-bold text-blue-800 mb-4">Video Pembelajaran</h4>
                                        <p class="text-blue-700 mb-6">Jika video tidak muncul, silakan klik tombol di bawah untuk menonton langsung di YouTube</p>
                                    </div>
                                    <div class="space-y-4">
                                        <a href="https://www.youtube.com/watch?v=YFx5aGlf7AE" 
                                           target="_blank" 
                                           class="inline-block bg-gradient-to-r from-red-600 to-red-700 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-red-700 hover:to-red-800 transition duration-300 shadow-lg">
                                            üé• Tonton di YouTube
                                        </a>
                                        <button onclick="retryVideo()" 
                                                class="block mx-auto bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-700 hover:to-indigo-700 transition duration-300">
                                            üîÑ Coba Lagi
                                        </button>
                                    </div>
                                    <div class="mt-6 bg-white rounded-xl p-4">
                                        <h5 class="font-bold text-gray-800 mb-2">Tips jika video tidak muncul:</h5>
                                        <ul class="text-gray-700 text-sm space-y-1">
                                            <li>‚Ä¢ Pastikan koneksi internet stabil</li>
                                            <li>‚Ä¢ Refresh halaman dan coba lagi</li>
                                            <li>‚Ä¢ Gunakan browser yang berbeda</li>
                                            <li>‚Ä¢ Nonaktifkan ad blocker sementara</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center mb-8">
                                <h3 class="text-2xl font-bold text-red-800 mb-4">Belajar Surah Al-Ashr dengan Metode Ummi</h3>
                                <p class="text-red-700 text-lg">Tonton video di atas untuk mempelajari cara membaca Surah Al-Ashr dengan benar</p>
                            </div>
                        </div>

                        <div class="mt-10 grid md:grid-cols-3 gap-8">
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-8 text-center border-2 border-green-200">
                                <span class="text-5xl mb-4 block">üéØ</span>
                                <h4 class="font-bold text-green-800 mb-3 text-xl">Tajwid yang Benar</h4>
                                <p class="text-green-700">Pelajari cara membaca dengan tajwid yang tepat sesuai kaidah</p>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-8 text-center border-2 border-blue-200">
                                <span class="text-5xl mb-4 block">üéµ</span>
                                <h4 class="font-bold text-blue-800 mb-3 text-xl">Lagu Merdu</h4>
                                <p class="text-blue-700">Dengarkan bacaan dengan lagu yang indah dan mudah diingat</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-8 text-center border-2 border-purple-200">
                                <span class="text-5xl mb-4 block">üìö</span>
                                <h4 class="font-bold text-purple-800 mb-3 text-xl">Metode Ummi</h4>
                                <p class="text-purple-700">Belajar dengan metode yang mudah dipahami dan efektif</p>
                            </div>
                        </div>



                        <!-- Video Recording Section -->
                        <div class="mt-10 bg-gradient-to-r from-orange-50 to-red-50 rounded-3xl p-8 border-2 border-orange-200">
                            <h3 class="text-2xl font-bold text-orange-800 mb-6 text-center">üé• Tugas Praktik Membaca</h3>
                            <p class="text-orange-700 text-center mb-8 text-lg">Setelah menonton video pembelajaran, sekarang giliran Anda untuk praktik!</p>
                            
                            <div class="max-w-4xl mx-auto">
                                <div class="bg-white rounded-2xl p-8 shadow-lg mb-6">
                                    <h4 class="text-xl font-bold text-gray-800 mb-4 text-center">üìã Instruksi Tugas</h4>
                                    <div class="space-y-4 text-gray-700">
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">1Ô∏è‚É£</span>
                                            <p><strong>Persiapan:</strong> Pastikan Anda sudah menonton video pembelajaran di atas dengan seksama</p>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">2Ô∏è‚É£</span>
                                            <p><strong>Rekam Video:</strong> Buatlah video Anda membaca Surah Al-Ashr dengan tajwid yang benar</p>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">3Ô∏è‚É£</span>
                                            <p><strong>Durasi:</strong> Video maksimal 3 menit, pastikan suara jelas dan bacaan terdengar dengan baik</p>
                                        </div>
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">4Ô∏è‚É£</span>
                                            <p><strong>Kirim ke Guru:</strong> Upload video Anda menggunakan tombol di bawah ini</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recording Interface -->
                                <div class="bg-white rounded-2xl p-8 shadow-lg">
                                    <div class="text-center mb-6">
                                        <div class="w-32 h-32 bg-gradient-to-br from-red-100 to-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <span class="text-6xl" id="recordIcon">üé•</span>
                                        </div>
                                        <h4 class="text-xl font-bold text-gray-800 mb-2">Perekaman Video</h4>
                                        <p class="text-gray-600" id="recordStatus">Siap untuk merekam</p>
                                    </div>

                                    <div class="flex flex-col items-center space-y-4">
                                        <div class="flex space-x-4">
                                            <button onclick="startRecording()" id="startBtn" 
                                                    class="bg-gradient-to-r from-red-500 to-red-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-red-600 hover:to-red-700 transition duration-300 shadow-lg">
                                                üî¥ Mulai Rekam
                                            </button>
                                            <button onclick="stopRecording()" id="stopBtn" disabled
                                                    class="bg-gradient-to-r from-gray-400 to-gray-500 text-white px-8 py-4 rounded-xl font-bold text-lg transition duration-300 shadow-lg">
                                                ‚èπÔ∏è Stop Rekam
                                            </button>
                                        </div>
                                        
                                        <div id="recordingTimer" class="hidden">
                                            <div class="bg-red-100 rounded-xl px-6 py-3">
                                                <span class="text-red-600 font-bold text-xl">‚è±Ô∏è <span id="timerDisplay">00:00</span></span>
                                            </div>
                                        </div>

                                        <video id="recordedVideo" class="hidden w-full max-w-md rounded-xl shadow-lg" controls></video>
                                        
                                        <div id="uploadSection" class="hidden w-full">
                                            <div class="bg-green-50 rounded-xl p-6 border-2 border-green-200">
                                                <h5 class="font-bold text-green-800 mb-4 text-center">‚úÖ Video Berhasil Direkam!</h5>
                                                <div class="flex flex-col space-y-4">
                                                    <input type="text" id="videoTitle" placeholder="Judul video (opsional)" 
                                                           class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:ring-4 focus:ring-green-200 focus:border-green-500">
                                                    <textarea id="videoNotes" placeholder="Catatan untuk guru (opsional)" rows="3"
                                                              class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:ring-4 focus:ring-green-200 focus:border-green-500"></textarea>
                                                    <div class="flex space-x-4">
                                                        <button onclick="submitVideo()" 
                                                                class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-4 rounded-xl font-bold hover:from-green-700 hover:to-emerald-700 transition duration-300">
                                                            üì§ Kirim ke Guru
                                                        </button>
                                                        <button onclick="retakeVideo()" 
                                                                class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-4 rounded-xl font-bold hover:from-orange-600 hover:to-orange-700 transition duration-300">
                                                            üîÑ Rekam Ulang
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Submission History -->
                                <div class="mt-8 bg-blue-50 rounded-2xl p-6 border-2 border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-800 mb-4 text-center">üìã Riwayat Pengiriman</h4>
                                    <div id="submissionHistory" class="space-y-3">
                                        <p class="text-blue-600 text-center italic">Belum ada video yang dikirim</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Game -->
            <div id="content-game" class="tab-content hidden">
                <div class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 rounded-3xl shadow-2xl p-4 md:p-10 relative overflow-hidden">
                    <!-- Animated background elements -->
                    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                        <div class="absolute top-10 left-10 w-20 h-20 bg-yellow-400 rounded-full opacity-20 animate-bounce"></div>
                        <div class="absolute top-20 right-20 w-16 h-16 bg-pink-400 rounded-full opacity-20 animate-pulse"></div>
                        <div class="absolute bottom-20 left-20 w-24 h-24 bg-green-400 rounded-full opacity-20 animate-bounce" style="animation-delay: 1s;"></div>
                        <div class="absolute bottom-10 right-10 w-18 h-18 bg-blue-400 rounded-full opacity-20 animate-pulse" style="animation-delay: 2s;"></div>
                        
                        <!-- Floating stars -->
                        <div class="absolute top-1/4 left-1/4 text-yellow-300 text-2xl animate-pulse opacity-30">‚≠ê</div>
                        <div class="absolute top-1/3 right-1/3 text-yellow-300 text-3xl animate-bounce opacity-30" style="animation-delay: 0.5s;">‚ú®</div>
                        <div class="absolute bottom-1/4 left-1/3 text-yellow-300 text-2xl animate-pulse opacity-30" style="animation-delay: 1.5s;">üåü</div>
                        <div class="absolute bottom-1/3 right-1/4 text-yellow-300 text-2xl animate-bounce opacity-30" style="animation-delay: 2.5s;">‚≠ê</div>
                    </div>
                    
                    <div class="relative z-10">
                        <!-- Game Header -->
                        <div class="text-center mb-8 md:mb-12">
                            <div class="inline-block bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full p-4 mb-6 shadow-2xl animate-pulse">
                                <span class="text-4xl md:text-6xl">üéÆ</span>
                            </div>
                            <h2 class="text-2xl md:text-4xl font-bold text-white mb-4 drop-shadow-lg">
                                <span class="bg-gradient-to-r from-yellow-400 to-pink-400 bg-clip-text text-transparent">
                                    GAME TEBAK ARTI KATA
                                </span>
                            </h2>
                            <p class="text-lg md:text-xl text-blue-200 font-semibold">Uji pemahamanmu tentang Surah Al-Ashr!</p>
                        </div>
                        
                        <div class="max-w-5xl mx-auto">
                            <!-- Game Stats -->
                            <div class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8 mb-8 md:mb-12">
                                <!-- Score Card -->
                                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]">
                                    <div class="text-center">
                                        <div class="text-3xl md:text-4xl mb-2">üèÜ</div>
                                        <div class="text-white font-bold text-lg md:text-xl mb-1">SKOR</div>
                                        <div id="gameScore" class="text-3xl md:text-5xl font-black text-white drop-shadow-lg">0</div>
                                    </div>
                                </div>
                                
                                <!-- Progress Card -->
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]">
                                    <div class="text-center">
                                        <div class="text-3xl md:text-4xl mb-2">üìä</div>
                                        <div class="text-white font-bold text-lg md:text-xl mb-1">PROGRESS</div>
                                        <div class="text-white">
                                            <span id="currentQuestion" class="text-3xl md:text-5xl font-black drop-shadow-lg">1</span>
                                            <span class="text-2xl md:text-3xl font-bold opacity-80">/20</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Level Card -->
                                <div class="bg-gradient-to-r from-green-500 to-teal-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]">
                                    <div class="text-center">
                                        <div class="text-3xl md:text-4xl mb-2">‚ö°</div>
                                        <div class="text-white font-bold text-lg md:text-xl mb-1">LEVEL</div>
                                        <div id="gameLevel" class="text-2xl md:text-3xl font-black text-white drop-shadow-lg">PEMULA</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Game Area -->
                            <div id="gameArea" class="bg-white/10 backdrop-blur-lg rounded-3xl p-6 md:p-10 border border-white/20 shadow-2xl">
                                <!-- Question Section -->
                                <div class="text-center mb-8 md:mb-12">
                                    <div class="inline-block bg-gradient-to-r from-blue-400 to-purple-500 rounded-2xl px-6 py-3 mb-6 shadow-xl">
                                        <h3 class="text-xl md:text-2xl font-bold text-white drop-shadow-lg">
                                            ‚ú® Apa arti dari kata ini? ‚ú®
                                        </h3>
                                    </div>
                                    
                                    <!-- Arabic Word Display -->
                                    <div class="relative">
                                        <div class="bg-gradient-to-br from-white to-blue-50 rounded-3xl p-8 md:p-12 shadow-2xl mb-8 border-4 border-yellow-300 relative overflow-hidden">
                                            <!-- Decorative elements -->
                                            <div class="absolute top-4 left-4 text-yellow-400 text-2xl animate-spin-slow">‚≠ê</div>
                                            <div class="absolute top-4 right-4 text-yellow-400 text-2xl animate-spin-slow" style="animation-delay: 1s;">‚ú®</div>
                                            <div class="absolute bottom-4 left-4 text-yellow-400 text-2xl animate-spin-slow" style="animation-delay: 2s;">üåü</div>
                                            <div class="absolute bottom-4 right-4 text-yellow-400 text-2xl animate-spin-slow" style="animation-delay: 3s;">‚≠ê</div>
                                            
                                            <div id="arabicWord" class="arabic-text text-6xl md:text-8xl lg:text-9xl text-indigo-800 font-bold drop-shadow-lg relative z-10 animate-pulse min-h-[120px] flex items-center justify-center text-center"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Options Grid -->
                                <div id="gameOptions" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-8">
                                    <!-- Options will be generated by JavaScript -->
                                </div>

                                <!-- Result Section -->
                                <div id="gameResult" class="hidden text-center mt-8">
                                    <div class="bg-white/20 backdrop-blur-lg rounded-3xl p-6 md:p-10 shadow-2xl border border-white/30">
                                        <div id="resultIcon" class="text-6xl md:text-8xl mb-4"></div>
                                        <h3 class="text-2xl md:text-4xl font-bold mb-4 text-white drop-shadow-lg" id="resultTitle"></h3>
                                        <p class="text-lg md:text-xl mb-8 text-blue-100" id="resultMessage"></p>
                                        <button onclick="nextQuestion()" 
                                                class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-8 py-4 rounded-2xl font-bold text-lg md:text-xl hover:from-green-600 hover:to-teal-600 transition-all duration-300 transform hover:scale-105 shadow-2xl">
                                            üöÄ Soal Berikutnya
                                        </button>
                                    </div>
                                </div>

                                <!-- Game Complete Section -->
                                <div id="gameComplete" class="hidden text-center">
                                    <div class="bg-gradient-to-br from-yellow-400 via-orange-500 to-red-500 rounded-3xl p-8 md:p-12 shadow-2xl border-4 border-yellow-300 relative overflow-hidden">
                                        <!-- Celebration animations -->
                                        <div class="absolute inset-0 overflow-hidden pointer-events-none">
                                            <div class="absolute top-0 left-1/4 text-6xl animate-bounce">üéâ</div>
                                            <div class="absolute top-0 right-1/4 text-6xl animate-bounce" style="animation-delay: 0.5s;">üéä</div>
                                            <div class="absolute top-1/2 left-0 text-4xl animate-pulse">üèÜ</div>
                                            <div class="absolute top-1/2 right-0 text-4xl animate-pulse" style="animation-delay: 1s;">‚≠ê</div>
                                        </div>
                                        
                                        <div class="relative z-10">
                                            <div class="text-8xl md:text-9xl mb-6 animate-bounce">üéâ</div>
                                            <h3 class="text-3xl md:text-5xl font-black text-white mb-6 drop-shadow-2xl">SELAMAT!</h3>
                                            <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-6 mb-8 border border-white/30">
                                                <p class="text-xl md:text-2xl text-white mb-4 font-bold">Game Selesai!</p>
                                                <p class="text-lg md:text-xl text-blue-100 mb-4">Skor Akhir: <span id="finalScore" class="font-black text-yellow-200 text-2xl md:text-3xl"></span>/20</p>
                                                <div id="finalAppreciation" class="text-lg md:text-xl font-bold text-white"></div>
                                            </div>
                                            <div class="flex flex-col md:flex-row gap-4 justify-center">
                                                <button onclick="restartGame()" 
                                                        class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-2xl font-bold text-lg md:text-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 shadow-2xl">
                                                    üîÑ Main Lagi
                                                </button>
                                                <button onclick="showTab('sertifikat')" id="certificateBtn" 
                                                        class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-8 py-4 rounded-2xl font-bold text-lg md:text-xl hover:from-yellow-600 hover:to-orange-600 transition-all duration-300 transform hover:scale-105 shadow-2xl hidden">
                                                    üèÜ Lihat Sertifikat
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Latihan -->
            <div id="content-latihan" class="tab-content hidden">
                <div class="bg-white rounded-3xl shadow-2xl p-10">
                    <h2 class="text-3xl font-bold text-center text-gray-800 mb-10">‚úçÔ∏è Latihan Menulis Surah Al-Ashr</h2>
                    
                    <div class="max-w-6xl mx-auto">
                        <!-- Mode Selection -->
                        <div class="flex justify-center mb-8">
                            <div class="bg-gray-100 rounded-2xl p-2 flex">
                                <button onclick="setWritingMode('trace')" id="traceMode" 
                                        class="px-6 py-3 rounded-xl font-bold transition duration-300 bg-blue-600 text-white">
                                    üìù Menebalkan Tulisan
                                </button>
                                <button onclick="setWritingMode('free')" id="freeMode" 
                                        class="px-6 py-3 rounded-xl font-bold transition duration-300 text-gray-700 hover:bg-gray-200">
                                    üé® Menulis Bebas
                                </button>
                            </div>
                        </div>

                        <!-- Tracing Exercise -->
                        <div id="tracingExercise" class="mb-8">
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-3xl p-8 border-2 border-blue-200 mb-6">
                                <h3 class="text-2xl font-bold text-blue-800 mb-6 text-center">Latihan Menebalkan Tulisan Arab</h3>
                                
                                <!-- Instruksi yang diperlebar -->
                                <div class="bg-white rounded-2xl p-6 mb-6 shadow-lg">
                                    <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                        <span class="text-2xl mr-3">üìã</span>
                                        Petunjuk Penggunaan
                                    </h4>
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div class="space-y-4">
                                            <div class="flex items-start space-x-3">
                                                <span class="text-xl">1Ô∏è‚É£</span>
                                                <div>
                                                    <p class="font-semibold text-gray-800">Pilih Ayat</p>
                                                    <p class="text-gray-600 text-sm">Klik tombol ayat yang ingin dipraktikkan</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start space-x-3">
                                                <span class="text-xl">2Ô∏è‚É£</span>
                                                <div>
                                                    <p class="font-semibold text-gray-800">Tebalkan Tulisan</p>
                                                    <p class="text-gray-600 text-sm">Ikuti garis putus-putus dengan mouse atau jari</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="space-y-4">
                                            <div class="flex items-start space-x-3">
                                                <span class="text-xl">3Ô∏è‚É£</span>
                                                <div>
                                                    <p class="font-semibold text-gray-800">Atur Warna & Ketebalan</p>
                                                    <p class="text-gray-600 text-sm">Gunakan tombol di bawah untuk mengubah warna dan ketebalan garis</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start space-x-3">
                                                <span class="text-xl">4Ô∏è‚É£</span>
                                                <div>
                                                    <p class="font-semibold text-gray-800">Selesaikan Semua Ayat</p>
                                                    <p class="text-gray-600 text-sm">Praktikkan ketiga ayat untuk menyelesaikan latihan</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-center mb-6">
                                    <div class="bg-white rounded-xl p-4 flex gap-4">
                                        <button onclick="selectAyat(1)" id="ayat1Btn" 
                                                class="ayat-btn px-4 py-2 rounded-lg font-bold bg-blue-600 text-white">
                                            Ayat 1
                                        </button>
                                        <button onclick="selectAyat(2)" id="ayat2Btn" 
                                                class="ayat-btn px-4 py-2 rounded-lg font-bold text-blue-600 hover:bg-blue-50">
                                            Ayat 2
                                        </button>
                                        <button onclick="selectAyat(3)" id="ayat3Btn" 
                                                class="ayat-btn px-4 py-2 rounded-lg font-bold text-blue-600 hover:bg-blue-50">
                                            Ayat 3
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="canvas-container p-6 relative">
                                <canvas id="backgroundCanvas" width="1400" height="600" 
                                        class="absolute top-6 left-6 w-full h-96 md:h-[500px] rounded-2xl pointer-events-none"></canvas>
                                <canvas id="drawingCanvas" width="1400" height="600" 
                                        class="relative w-full h-96 md:h-[500px] cursor-crosshair rounded-2xl bg-transparent"></canvas>
                            </div>
                        </div>

                        <!-- Free Writing Mode -->
                        <div id="freeWriting" class="mb-8 hidden">
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-3xl p-8 border-2 border-green-200 mb-6">
                                <h3 class="text-2xl font-bold text-green-800 mb-4 text-center">Menulis Bebas</h3>
                                <p class="text-green-700 text-center mb-6">Latih menulis Arab dengan bebas di canvas kosong</p>
                            </div>
                            
                            <div class="canvas-container p-6">
                                <canvas id="freeCanvas" width="1400" height="600" 
                                        class="w-full h-96 md:h-[500px] cursor-crosshair rounded-2xl bg-white shadow-inner"></canvas>
                            </div>
                        </div>

                        <!-- Controls -->
                        <div class="flex flex-wrap justify-center gap-4 mb-8">
                            <button onclick="clearCanvas()" 
                                    class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-xl font-bold hover:from-red-600 hover:to-red-700 transition duration-300 shadow-lg">
                                üóëÔ∏è Hapus Semua
                            </button>
                            <button onclick="changeColor('black')" 
                                    class="bg-gradient-to-r from-gray-800 to-black text-white px-6 py-3 rounded-xl font-bold hover:from-gray-900 hover:to-gray-800 transition duration-300 shadow-lg">
                                ‚ö´ Hitam
                            </button>
                            <button onclick="changeColor('blue')" 
                                    class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-600 hover:to-blue-700 transition duration-300 shadow-lg">
                                üîµ Biru
                            </button>
                            <button onclick="changeColor('green')" 
                                    class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-bold hover:from-green-600 hover:to-green-700 transition duration-300 shadow-lg">
                                üü¢ Hijau
                            </button>
                            <button onclick="changeStroke(3)" 
                                    class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-xl font-bold hover:from-gray-600 hover:to-gray-700 transition duration-300 shadow-lg">
                                üìè Tipis
                            </button>
                            <button onclick="changeStroke(8)" 
                                    class="bg-gradient-to-r from-gray-600 to-gray-700 text-white px-6 py-3 rounded-xl font-bold hover:from-gray-700 hover:to-gray-800 transition duration-300 shadow-lg">
                                üìè Tebal
                            </button>
                        </div>

                        <!-- Progress Tracking -->
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-3xl p-8 border-2 border-purple-200">
                            <h4 class="text-2xl font-bold text-purple-800 mb-6 text-center">üìä Progress Latihan</h4>
                            <div class="grid md:grid-cols-3 gap-6">
                                <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
                                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span class="text-2xl" id="ayat1Progress">‚≠ï</span>
                                    </div>
                                    <h5 class="font-bold text-purple-700 mb-2">Ayat 1</h5>
                                    <p class="text-purple-600 text-sm">ŸàŸéÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê</p>
                                </div>
                                <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
                                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span class="text-2xl" id="ayat2Progress">‚≠ï</span>
                                    </div>
                                    <h5 class="font-bold text-purple-700 mb-2">Ayat 2</h5>
                                    <p class="text-purple-600 text-sm">ÿ•ŸêŸÜŸéŸë ÿßŸÑŸíÿ•ŸêŸÜÿ≥ŸéÿßŸÜŸé ŸÑŸéŸÅŸêŸä ÿÆŸèÿ≥Ÿíÿ±Ÿç</p>
                                </div>
                                <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
                                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span class="text-2xl" id="ayat3Progress">‚≠ï</span>
                                    </div>
                                    <h5 class="font-bold text-purple-700 mb-2">Ayat 3</h5>
                                    <p class="text-purple-600 text-sm">ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Sertifikat -->
            <div id="content-sertifikat" class="tab-content hidden">
                <div class="max-w-5xl mx-auto">
                    <!-- Certificate Locked Screen -->
                    <div id="certificateLocked" class="bg-gradient-to-r from-red-50 to-orange-50 rounded-3xl p-10 border-2 border-red-200 text-center">
                        <div class="mb-8">
                            <div class="w-32 h-32 bg-gradient-to-br from-red-100 to-orange-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <span class="text-6xl">üîí</span>
                            </div>
                            <h2 class="text-3xl font-bold text-red-800 mb-4">Sertifikat Terkunci</h2>
                            <p class="text-red-700 text-lg mb-8">Selesaikan semua bagian pembelajaran untuk membuka sertifikat</p>
                        </div>
                        
                        <!-- Progress Checklist -->
                        <div class="bg-white rounded-2xl p-8 shadow-lg mb-8">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">üìã Daftar Tugas</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="flex items-center space-x-4 p-4 rounded-xl border-2 border-gray-200">
                                    <div id="materiLockStatus" class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                        <span class="text-2xl">üìö</span>
                                    </div>
                                    <div class="text-left">
                                        <h4 class="font-bold text-gray-800">Materi</h4>
                                        <p id="materiLockText" class="text-sm text-gray-500">Belum Selesai</p>
                                        <p class="text-xs text-gray-400">Klik "SAYA PAHAM"</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 rounded-xl border-2 border-gray-200">
                                    <div id="videoLockStatus" class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                        <span class="text-2xl">üé•</span>
                                    </div>
                                    <div class="text-left">
                                        <h4 class="font-bold text-gray-800">Video</h4>
                                        <p id="videoLockText" class="text-sm text-gray-500">Belum Selesai</p>
                                        <p class="text-xs text-gray-400">Upload video bacaan</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 rounded-xl border-2 border-gray-200">
                                    <div id="gameLockStatus" class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                        <span class="text-2xl">üéÆ</span>
                                    </div>
                                    <div class="text-left">
                                        <h4 class="font-bold text-gray-800">Game</h4>
                                        <p id="gameLockText" class="text-sm text-gray-500">Belum Selesai</p>
                                        <p class="text-xs text-gray-400">Selesaikan 20 soal</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-4 p-4 rounded-xl border-2 border-gray-200">
                                    <div id="latihanLockStatus" class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                        <span class="text-2xl">‚úçÔ∏è</span>
                                    </div>
                                    <div class="text-left">
                                        <h4 class="font-bold text-gray-800">Latihan</h4>
                                        <p id="latihanLockText" class="text-sm text-gray-500">Belum Selesai</p>
                                        <p class="text-xs text-gray-400">Praktik menulis 3 ayat</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tips Section -->
                        <div class="bg-blue-50 rounded-2xl p-6 border-2 border-blue-200">
                            <h4 class="text-xl font-bold text-blue-800 mb-4">üí° Tips Menyelesaikan Pembelajaran</h4>
                            <div class="grid md:grid-cols-2 gap-4 text-left">
                                <div class="space-y-2">
                                    <p class="text-blue-700"><strong>üìö Materi:</strong> Baca semua materi dengan seksama, lalu klik tombol "SAYA PAHAM"</p>
                                    <p class="text-blue-700"><strong>üé• Video:</strong> Tonton video pembelajaran, lalu rekam dan kirim video bacaan Anda</p>
                                </div>
                                <div class="space-y-2">
                                    <p class="text-blue-700"><strong>üéÆ Game:</strong> Mainkan game tebak arti kata hingga selesai 20 soal</p>
                                    <p class="text-blue-700"><strong>‚úçÔ∏è Latihan:</strong> Praktikkan menulis ketiga ayat Al-Ashr</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Certificate Unlocked (Hidden by default) -->
                    <div id="certificateUnlocked" class="hidden">
                        <div class="certificate bg-gradient-to-br from-yellow-50 via-orange-50 to-yellow-100 rounded-3xl p-16 text-center relative overflow-hidden shadow-2xl border-8 border-yellow-400">
                            <!-- Animated stars -->
                            <div class="absolute top-4 left-4 text-yellow-400 text-2xl animate-pulse">‚≠ê</div>
                            <div class="absolute top-8 right-8 text-yellow-400 text-3xl animate-bounce">‚ú®</div>
                            <div class="absolute bottom-6 left-8 text-yellow-400 text-2xl animate-pulse">üåü</div>
                            <div class="absolute bottom-4 right-4 text-yellow-400 text-2xl animate-bounce">‚≠ê</div>
                            
                            <!-- Multiple decorative borders -->
                            <div class="absolute inset-4 border-4 border-dashed border-yellow-300 rounded-2xl"></div>
                            <div class="absolute inset-8 border-2 border-yellow-200 rounded-xl"></div>
                            
                            <div class="relative z-10">
                                <div class="mb-10">
                                    <div class="w-32 h-32 bg-gradient-to-br from-yellow-300 to-orange-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                                        <span class="text-6xl">üèÜ</span>
                                    </div>
                                    <h2 class="text-5xl font-bold mb-4 text-blue-800">SERTIFIKAT</h2>
                                    <div class="w-32 h-1 bg-blue-600 mx-auto mb-4"></div>
                                    <p class="text-2xl font-semibold text-blue-700">Media Pembelajaran Al-Quran Hadits</p>
                                </div>

                                <div class="mb-10">
                                    <p class="text-xl mb-6 text-blue-700">Dengan bangga diberikan kepada:</p>
                                    <div class="bg-white bg-opacity-80 rounded-2xl p-8 mb-6 shadow-lg border-2 border-yellow-300">
                                        <h3 id="certificateName" class="text-4xl font-bold mb-4 text-blue-800">-</h3>
                                        <p class="text-xl text-blue-700">Kelas: <span id="certificateClass" class="font-bold text-blue-800">-</span></p>
                                    </div>
                                </div>

                                <div class="mb-10">
                                    <p class="text-xl mb-6 text-blue-700">Telah berhasil menyelesaikan pembelajaran</p>
                                    <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-2xl p-6 mb-6 shadow-lg">
                                        <h4 class="text-3xl font-bold mb-2">SURAH AL-ASHR</h4>
                                        <p class="text-lg font-semibold">ÿ≥ŸèŸàÿ±Ÿéÿ©Ÿè ÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê</p>
                                    </div>
                                    <p id="certificateAppreciation" class="text-lg text-blue-700">dengan prestasi yang membanggakan</p>
                                </div>

                                <div class="flex justify-center items-center space-x-12 mb-10">
                                    <div class="text-center">
                                        <div class="w-20 h-20 bg-green-400 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                                            <span class="text-3xl">‚úÖ</span>
                                        </div>
                                        <p class="font-semibold text-blue-800">Materi</p>
                                        <p class="text-sm text-blue-600">Dipahami</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-20 h-20 bg-green-400 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                                            <span class="text-3xl">‚úÖ</span>
                                        </div>
                                        <p class="font-semibold text-blue-800">Video</p>
                                        <p class="text-sm text-blue-600">Dikirim</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-20 h-20 bg-green-400 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                                            <span class="text-3xl">‚úÖ</span>
                                        </div>
                                        <p class="font-semibold text-blue-800">Game</p>
                                        <p class="text-sm text-blue-600">Selesai</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-20 h-20 bg-green-400 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                                            <span class="text-3xl">‚úÖ</span>
                                        </div>
                                        <p class="font-semibold text-blue-800">Latihan</p>
                                        <p class="text-sm text-blue-600">Dipraktikkan</p>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <p class="text-lg text-blue-700 mb-4">Tanggal: <span id="certificateDate" class="font-semibold"></span></p>
                                    <div class="flex justify-center space-x-16">
                                        <div class="text-center">
                                            <!-- Teacher signature placeholder -->
                                            <div class="w-32 h-16 bg-white rounded-lg mb-2 flex items-center justify-center border-2 border-blue-200">
                                                <span class="text-xs text-blue-600">Tanda Tangan</span>
                                            </div>
                                            <div class="border-t-2 border-blue-600 w-40 mx-auto pt-3">
                                                <p class="font-bold text-blue-800">Guru Pengampu</p>
                                                <p class="text-sm text-blue-600">MAHFUD SIDIK, S.Pd.I</p>
                                            </div>
                                        </div>
                                        <div class="text-center">
                                            <!-- Principal signature placeholder -->
                                            <div class="w-32 h-16 bg-white rounded-lg mb-2 flex items-center justify-center border-2 border-blue-200">
                                                <span class="text-xs text-blue-600">Tanda Tangan</span>
                                            </div>
                                            <div class="border-t-2 border-blue-600 w-40 mx-auto pt-3">
                                                <p class="font-bold text-blue-800">Kepala Madrasah</p>
                                                <p class="text-sm text-blue-600">MUSLIMAH, S.Pd.I</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-10">
                            <button onclick="downloadCertificate()" 
                                    class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-10 py-5 rounded-2xl font-bold text-xl hover:from-blue-700 hover:to-indigo-700 transition duration-300 shadow-2xl">
                                üì• Unduh Sertifikat
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to mark materi as complete
        function markMateriComplete() {
            const btn = document.getElementById('materiPahamBtn');
            const message = document.getElementById('materiCompleteMessage');
            
            // Update button
            btn.innerHTML = '‚úÖ SUDAH PAHAM';
            btn.disabled = true;
            btn.className = 'bg-gradient-to-r from-gray-400 to-gray-500 text-white px-12 py-6 rounded-2xl font-bold text-2xl cursor-not-allowed shadow-lg';
            
            // Show success message
            message.classList.remove('hidden');
            
            // Mark materi as completed
            updateProgress('materi');
            
            // Show celebration animation
            setTimeout(() => {
                alert('üéâ Selamat!\n\nAnda telah menyelesaikan bagian Materi!\nProgress pembelajaran Anda bertambah.');
            }, 500);
        }
        // ========================================
        // üîß KONFIGURASI GOOGLE DRIVE API
        // ========================================
        
        const GOOGLE_DRIVE_CONFIG = {
            folderId: '1C-qp2Jm48DmewY9n6xItlQXU_Azmuozz',       // ID folder Google Drive untuk video
            uploadUrl: 'https://script.google.com/macros/s/AKfycbzq5tq_AWbaxNQtXBWI05EDDNx5DUbaMwfWCdMtKAAQZV2GnK_YYk1i1JedkK-_BF1q/exec', // URL Google Apps Script
            maxFileSize: 50 * 1024 * 1024, // 50MB limit
            allowedTypes: ['video/webm', 'video/mp4', 'video/mov']
        };
        
        // CARA MENDAPATKAN KONFIGURASI:
        // 1. Buka console.cloud.google.com
        // 2. Buat project baru atau pilih project yang ada
        // 3. Aktifkan Google Drive API di Library
        // 4. Buat credentials (API Key dan OAuth 2.0 Client ID)
        // 5. Buat folder di Google Drive dan salin ID folder dari URL
        // 6. Ganti nilai di atas dengan konfigurasi Anda
        
        // ========================================
        // VARIABEL APLIKASI
        // ========================================
        
        let currentStudent = { name: '', class: '' };
        let canvas, ctx, backgroundCanvas, backgroundCtx, freeCanvas, freeCtx;
        let isDrawing = false;
        let currentColor = 'black';
        let currentStroke = 3;
        let currentWritingMode = 'trace';
        let currentAyat = 1;
        let ayatProgress = { 1: false, 2: false, 3: false };
        
        // Progress tracking
        let learningProgress = {
            materi: false,
            video: false,
            game: false,
            latihan: false
        };
        
        // Video recording variables
        let mediaRecorder;
        let recordedChunks = [];
        let stream;
        let recordingTimer;
        let recordingStartTime;
        let submissionHistory = [];

        // Game variables
        let gameScore = 0;
        let currentQuestionIndex = 0;
        let gameQuestions = [
            // Soal 1-10: Kata per kata
            { arabic: 'ŸàŸé', correct: 'Dan/Demi', options: ['Dan/Demi', 'Atau', 'Tetapi', 'Karena'] },
            { arabic: 'ÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê', correct: 'Masa/Waktu', options: ['Masa/Waktu', 'Hari', 'Malam', 'Pagi'] },
            { arabic: 'ÿ•ŸêŸÜŸéŸë', correct: 'Sesungguhnya', options: ['Sesungguhnya', 'Sungguh', 'Benar', 'Pasti'] },
            { arabic: 'ÿßŸÑŸíÿ•ŸêŸÜÿ≥ŸéÿßŸÜŸé', correct: 'Manusia', options: ['Manusia', 'Orang', 'Makhluk', 'Hamba'] },
            { arabic: 'ŸÑŸéŸÅŸêŸä', correct: 'Benar-benar dalam', options: ['Benar-benar dalam', 'Sedang dalam', 'Akan dalam', 'Telah dalam'] },
            { arabic: 'ÿÆŸèÿ≥Ÿíÿ±Ÿç', correct: 'Kerugian', options: ['Kerugian', 'Keuntungan', 'Kesedihan', 'Kebahagiaan'] },
            { arabic: 'ÿ•ŸêŸÑŸéŸëÿß', correct: 'Kecuali', options: ['Kecuali', 'Selain', 'Hanya', 'Tetapi'] },
            { arabic: 'ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé', correct: 'Orang-orang yang', options: ['Orang-orang yang', 'Mereka yang', 'Siapa yang', 'Yang mana'] },
            { arabic: 'ÿ¢ŸÖŸéŸÜŸèŸàÿß', correct: 'Beriman', options: ['Beriman', 'Percaya', 'Yakin', 'Taat'] },
            { arabic: 'ŸàŸéÿπŸéŸÖŸêŸÑŸèŸàÿß', correct: 'Dan mengerjakan', options: ['Dan mengerjakan', 'Serta melakukan', 'Kemudian berbuat', 'Lalu mengamalkan'] },
            
            // Soal 11-15: Frasa gabungan
            { arabic: 'ÿßŸÑÿµŸéŸëÿßŸÑŸêÿ≠Ÿéÿßÿ™Ÿê', correct: 'Amal saleh', options: ['Amal saleh', 'Perbuatan baik', 'Kebaikan', 'Ibadah'] },
            { arabic: 'ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß', correct: 'Dan saling menasehati', options: ['Dan saling menasehati', 'Serta menasehati', 'Kemudian berpesan', 'Lalu mengajak'] },
            { arabic: 'ÿ®ŸêÿßŸÑŸíÿ≠ŸéŸÇŸêŸë', correct: 'Dengan kebenaran', options: ['Dengan kebenaran', 'Tentang kebenaran', 'Dalam kebenaran', 'Untuk kebenaran'] },
            { arabic: 'ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê', correct: 'Dengan kesabaran', options: ['Dengan kesabaran', 'Tentang kesabaran', 'Dalam kesabaran', 'Untuk kesabaran'] },
            { arabic: 'ŸÑŸéŸÅŸêŸä ÿÆŸèÿ≥Ÿíÿ±Ÿç', correct: 'Benar-benar dalam kerugian', options: ['Benar-benar dalam kerugian', 'Sedang merugi', 'Akan rugi', 'Telah rugi'] },
            
            // Soal 16-20: Kalimat lengkap dan pemahaman
            { arabic: 'ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß', correct: 'Kecuali orang-orang yang beriman', options: ['Kecuali orang-orang yang beriman', 'Selain mereka yang percaya', 'Hanya yang beriman', 'Tetapi orang beriman'] },
            { arabic: 'ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß ÿ®ŸêÿßŸÑŸíÿ≠ŸéŸÇŸêŸë', correct: 'Dan saling menasehati dengan kebenaran', options: ['Dan saling menasehati dengan kebenaran', 'Serta berpesan tentang kebenaran', 'Kemudian mengajak pada kebenaran', 'Lalu berdakwah dengan benar'] },
            { arabic: 'ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê', correct: 'Dan saling menasehati dengan kesabaran', options: ['Dan saling menasehati dengan kesabaran', 'Serta berpesan tentang kesabaran', 'Kemudian mengajak bersabar', 'Lalu berdakwah dengan sabar'] },
            { arabic: 'ŸàŸéÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê', correct: 'Demi masa', options: ['Demi masa', 'Demi waktu', 'Demi zaman', 'Demi hari'] },
            { arabic: 'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸíÿ•ŸêŸÜÿ≥ŸéÿßŸÜŸé ŸÑŸéŸÅŸêŸä ÿÆŸèÿ≥Ÿíÿ±Ÿç', correct: 'Sesungguhnya manusia benar-benar dalam kerugian', options: ['Sesungguhnya manusia benar-benar dalam kerugian', 'Sungguh manusia sedang merugi', 'Benar manusia akan rugi', 'Pasti manusia telah rugi'] }
        ];

        // Form submission
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('nameInput').value;
            const studentClass = document.getElementById('classInput').value;
            
            currentStudent.name = name;
            currentStudent.class = studentClass;
            
            // Update header (both desktop and mobile)
            document.getElementById('studentName').textContent = name;
            document.getElementById('studentClass').textContent = `Kelas ${studentClass}`;
            document.getElementById('studentInfo').classList.remove('hidden');
            
            // Update mobile header
            document.getElementById('studentNameMobile').textContent = name;
            document.getElementById('studentClassMobile').textContent = `Kelas ${studentClass}`;
            document.getElementById('studentInfoMobile').classList.remove('hidden');
            
            // Update certificate
            document.getElementById('certificateName').textContent = name;
            document.getElementById('certificateClass').textContent = studentClass;
            document.getElementById('certificateDate').textContent = new Date().toLocaleDateString('id-ID');
            
            // Hide form, show content
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('learningContent').classList.remove('hidden');
            
            // Initialize canvas and game
            setTimeout(() => {
                initCanvas();
                initGame();
                
                // Add click event listeners to all tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const tabName = this.id.replace('tab-', '');
                        showTab(tabName);
                    });
                });
                
                console.log('Tab event listeners added');
            }, 100);
        });

        // Progress tracking functions
        function updateProgress(section) {
            learningProgress[section] = true;
            updateProgressDisplay();
        }
        
        function updateCertificateStatus() {
            // Update lock status for each section
            const sections = ['materi', 'video', 'game', 'latihan'];
            
            sections.forEach(section => {
                const isComplete = learningProgress[section];
                const lockStatus = document.getElementById(`${section}LockStatus`);
                const lockText = document.getElementById(`${section}LockText`);
                const lockParent = lockStatus?.parentElement;
                
                if (lockStatus && lockText && lockParent) {
                    if (isComplete) {
                        lockStatus.textContent = '‚úÖ';
                        lockText.textContent = 'Selesai';
                        lockText.className = 'text-sm text-green-600 font-semibold';
                        lockParent.className = 'w-16 h-16 bg-green-200 rounded-full flex items-center justify-center mx-auto mb-3';
                    } else {
                        lockStatus.textContent = section === 'materi' ? 'üìö' : section === 'video' ? 'üé•' : section === 'game' ? 'üéÆ' : '‚úçÔ∏è';
                        lockText.textContent = 'Belum Selesai';
                        lockText.className = 'text-sm text-gray-500';
                        lockParent.className = 'w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-3';
                    }
                }
            });
            
            // Check if all sections are complete
            const allComplete = Object.values(learningProgress).every(Boolean);
            
            const certificateLocked = document.getElementById('certificateLocked');
            const certificateUnlocked = document.getElementById('certificateUnlocked');
            
            if (allComplete) {
                if (certificateLocked) certificateLocked.classList.add('hidden');
                if (certificateUnlocked) certificateUnlocked.classList.remove('hidden');
                
                // Update certificate with appreciation
                const appreciation = currentStudent.appreciation || 'dengan prestasi yang membanggakan';
                const appreciationElement = document.getElementById('certificateAppreciation');
                if (appreciationElement) {
                    appreciationElement.textContent = appreciation;
                }
            } else {
                if (certificateLocked) certificateLocked.classList.remove('hidden');
                if (certificateUnlocked) certificateUnlocked.classList.add('hidden');
            }
        }
        
        function updateProgressDisplay() {
            // Update individual progress icons
            const progressIcons = {
                materi: learningProgress.materi ? '‚úÖ' : 'üìö',
                video: learningProgress.video ? '‚úÖ' : 'üé•',
                game: learningProgress.game ? '‚úÖ' : 'üéÆ',
                latihan: learningProgress.latihan ? '‚úÖ' : '‚úçÔ∏è'
            };
            
            Object.keys(progressIcons).forEach(key => {
                // Update desktop progress
                const element = document.getElementById(`${key}Progress`);
                if (element) {
                    element.textContent = progressIcons[key];
                    const parent = element.parentElement;
                    if (learningProgress[key]) {
                        parent.className = 'w-8 h-8 rounded-full bg-green-200 flex items-center justify-center mx-auto mb-1';
                    } else {
                        parent.className = 'w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mx-auto mb-1';
                    }
                }
                
                // Update mobile progress
                const mobileElement = document.getElementById(`${key}ProgressMobile`);
                if (mobileElement) {
                    mobileElement.textContent = progressIcons[key];
                    const mobileParent = mobileElement.parentElement;
                    if (learningProgress[key]) {
                        mobileParent.className = 'w-6 h-6 rounded-full bg-green-200 flex items-center justify-center mx-auto';
                    } else {
                        mobileParent.className = 'w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center mx-auto';
                    }
                }
            });
            
            // Calculate overall progress
            const completedSections = Object.values(learningProgress).filter(Boolean).length;
            const totalSections = Object.keys(learningProgress).length;
            const percentage = Math.round((completedSections / totalSections) * 100);
            
            // Update desktop progress bar
            const progressBar = document.getElementById('overallProgress');
            const progressText = document.getElementById('progressPercentage');
            
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
            }
            if (progressText) {
                progressText.textContent = percentage;
            }
            
            // Update mobile progress bar
            const mobileProgressBar = document.getElementById('overallProgressMobile');
            const mobileProgressText = document.getElementById('progressPercentageMobile');
            
            if (mobileProgressBar) {
                mobileProgressBar.style.width = `${percentage}%`;
            }
            if (mobileProgressText) {
                mobileProgressText.textContent = percentage;
            }
            
            // Update certificate status
            updateCertificateStatus();
        }

        // Tab functionality
        function showTab(tabName) {
            console.log('Switching to tab:', tabName); // Debug log
            
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tabs (mobile)
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.id.includes('desktop')) {
                    btn.className = 'tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600';
                } else if (btn.id === 'tab-sertifikat') {
                    btn.className = 'tab-btn w-full px-3 py-3 rounded-xl font-bold text-sm transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600';
                } else {
                    btn.className = 'tab-btn px-3 py-3 rounded-xl font-bold text-sm transition duration-300 text-gray-700 hover:bg-blue-50 hover:text-blue-600';
                }
            });
            
            // Show selected content
            const contentElement = document.getElementById(`content-${tabName}`);
            if (contentElement) {
                contentElement.classList.remove('hidden');
            } else {
                console.error('Content element not found:', `content-${tabName}`);
            }
            
            // Add active class to selected tab (mobile)
            const activeTab = document.getElementById(`tab-${tabName}`);
            const activeTabDesktop = document.getElementById(`tab-${tabName}-desktop`);
            
            if (activeTab) {
                if (tabName === 'sertifikat') {
                    activeTab.className = 'tab-btn w-full px-3 py-3 rounded-xl font-bold text-sm transition duration-300 bg-blue-600 text-white shadow-lg hover:bg-blue-700';
                } else {
                    activeTab.className = 'tab-btn px-3 py-3 rounded-xl font-bold text-sm transition duration-300 bg-blue-600 text-white shadow-lg hover:bg-blue-700';
                }
            }
            
            if (activeTabDesktop) {
                activeTabDesktop.className = 'tab-btn px-6 py-4 mx-1 mb-2 rounded-2xl font-bold text-lg transition duration-300 bg-blue-600 text-white shadow-lg hover:bg-blue-700';
            }
            
            // Don't auto-mark sections as complete when opening tabs
            // Progress is now tracked by specific actions (PAHAM button, video upload, etc.)
            
            // Initialize specific tab content if needed
            if (tabName === 'latihan' && !canvas) {
                setTimeout(() => {
                    initCanvas();
                }, 100);
            }
            
            if (tabName === 'game') {
                setTimeout(() => {
                    console.log('Game tab opened, initializing...'); // Debug log
                    initGame();
                }, 100);
            }
            
            if (tabName === 'video') {
                initVideoTab();
            }
        }

        // Game functionality
        function initGame() {
            console.log('Initializing game...'); // Debug log
            gameScore = 0;
            currentQuestionIndex = 0;
            
            // Make sure game area is visible
            const gameArea = document.getElementById('gameArea');
            const gameComplete = document.getElementById('gameComplete');
            
            if (gameArea) {
                gameArea.style.display = 'block';
                gameArea.classList.remove('hidden');
            }
            
            if (gameComplete) {
                gameComplete.classList.add('hidden');
            }
            
            updateGameDisplay();
            
            // Add small delay to ensure DOM is ready
            setTimeout(() => {
                showQuestion();
            }, 100);
        }

        function updateGameDisplay() {
            document.getElementById('gameScore').textContent = gameScore;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
        }

        function showQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                showGameComplete();
                return;
            }

            const question = gameQuestions[currentQuestionIndex];
            
            // Make sure the Arabic word is visible and properly styled
            const arabicWordElement = document.getElementById('arabicWord');
            if (arabicWordElement) {
                arabicWordElement.textContent = question.arabic;
                arabicWordElement.style.display = 'block';
                arabicWordElement.style.visibility = 'visible';
                console.log('Showing question:', question.arabic); // Debug log
            }
            
            // Update level based on progress
            updateGameLevel();
            
            const optionsContainer = document.getElementById('gameOptions');
            if (optionsContainer) {
                optionsContainer.innerHTML = '';
                
                // Randomize the options order
                const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
                
                shuffledOptions.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'game-card game-option rounded-2xl p-6 shadow-2xl border-2 border-transparent transform transition-all duration-300 hover:scale-105 cursor-pointer';
                    optionDiv.style.animationDelay = `${index * 0.1}s`;
                    optionDiv.innerHTML = `
                        <div class="flex items-center justify-center relative z-10">
                            <div class="text-2xl mr-4">${getOptionIcon(index)}</div>
                            <span class="text-lg md:text-xl font-bold text-gray-800 text-center flex-1">${option}</span>
                        </div>
                    `;
                    optionDiv.onclick = () => selectAnswer(option, optionDiv);
                    
                    // Add entrance animation
                    optionDiv.style.opacity = '0';
                    optionDiv.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        optionDiv.style.opacity = '1';
                        optionDiv.style.transform = 'translateY(0)';
                    }, index * 100);
                    
                    optionsContainer.appendChild(optionDiv);
                });
            }

            // Make sure game result is hidden
            const gameResult = document.getElementById('gameResult');
            if (gameResult) {
                gameResult.classList.add('hidden');
            }
            
            // Show the game area if it's hidden
            const gameArea = document.getElementById('gameArea');
            if (gameArea) {
                gameArea.style.display = 'block';
            }
        }
        
        function getOptionIcon(index) {
            const icons = ['üÖ∞Ô∏è', 'üÖ±Ô∏è', 'üÖ≤Ô∏è', 'üÖ≥Ô∏è'];
            return icons[index] || '‚≠ê';
        }
        
        function updateGameLevel() {
            const levelElement = document.getElementById('gameLevel');
            const progress = currentQuestionIndex + 1;
            
            if (progress <= 5) {
                levelElement.textContent = 'PEMULA';
                levelElement.parentElement.parentElement.className = 'bg-gradient-to-r from-green-500 to-teal-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]';
            } else if (progress <= 10) {
                levelElement.textContent = 'MENENGAH';
                levelElement.parentElement.parentElement.className = 'bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]';
            } else if (progress <= 15) {
                levelElement.textContent = 'MAHIR';
                levelElement.parentElement.parentElement.className = 'bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]';
            } else {
                levelElement.textContent = 'EXPERT';
                levelElement.parentElement.parentElement.className = 'bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl p-4 md:p-6 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[200px]';
            }
        }

        function selectAnswer(selectedAnswer, element) {
            const question = gameQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            // Disable all options
            document.querySelectorAll('.game-card').forEach(card => {
                card.onclick = null;
                card.style.cursor = 'default';
                card.style.transform = 'scale(0.95)';
                card.style.opacity = '0.7';
            });
            
            // Reset selected element
            element.style.transform = 'scale(1)';
            element.style.opacity = '1';
            
            // Show result with enhanced animations
            if (isCorrect) {
                element.classList.add('correct');
                gameScore++;
                
                // Add celebration effects
                createCelebrationEffect(element);
                
                document.getElementById('resultIcon').textContent = 'üéâ';
                document.getElementById('resultTitle').textContent = 'BENAR!';
                document.getElementById('resultMessage').textContent = `Hebat! Jawaban "${selectedAnswer}" adalah tepat!`;
                
                // Play success sound effect (visual feedback)
                element.style.boxShadow = '0 0 30px rgba(16, 185, 129, 0.8)';
                
            } else {
                element.classList.add('incorrect');
                document.getElementById('resultIcon').textContent = '‚ùå';
                document.getElementById('resultTitle').textContent = 'BELUM TEPAT!';
                document.getElementById('resultMessage').textContent = `Jawaban yang benar adalah "${question.correct}". Jangan menyerah, terus belajar!`;
                
                // Highlight correct answer with special effect
                document.querySelectorAll('.game-card').forEach(card => {
                    const cardText = card.querySelector('span').textContent;
                    if (cardText === question.correct) {
                        card.classList.add('correct');
                        card.style.transform = 'scale(1.05)';
                        card.style.opacity = '1';
                        card.style.boxShadow = '0 0 25px rgba(16, 185, 129, 0.6)';
                        
                        // Add pulsing effect to correct answer
                        setTimeout(() => {
                            card.style.animation = 'correctPulse 1s ease-in-out';
                        }, 300);
                    }
                });
            }
            
            updateGameDisplay();
            
            // Show result with slide-in animation
            const resultElement = document.getElementById('gameResult');
            resultElement.classList.remove('hidden');
            resultElement.style.opacity = '0';
            resultElement.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                resultElement.style.opacity = '1';
                resultElement.style.transform = 'translateY(0)';
            }, 100);
        }
        
        function createCelebrationEffect(element) {
            // Create floating particles effect
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '10px';
                particle.style.height = '10px';
                particle.style.background = '#fbbf24';
                particle.style.borderRadius = '50%';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '1000';
                
                const rect = element.getBoundingClientRect();
                particle.style.left = (rect.left + rect.width / 2) + 'px';
                particle.style.top = (rect.top + rect.height / 2) + 'px';
                
                document.body.appendChild(particle);
                
                // Animate particle
                const angle = (i / 6) * Math.PI * 2;
                const distance = 100;
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                
                particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${endX}px, ${endY}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'ease-out'
                }).onfinish = () => particle.remove();
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        function showGameComplete() {
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('finalScore').textContent = gameScore;
            
            // Calculate percentage and determine appreciation
            const percentage = Math.round((gameScore / 20) * 100);
            let appreciation = '';
            let appreciationIcon = '';
            let statusClass = '';
            
            if (percentage >= 90) {
                appreciation = 'LUAR BIASA';
                appreciationIcon = '‚≠ê‚≠ê‚≠ê';
                statusClass = 'text-yellow-600';
            } else if (percentage >= 80) {
                appreciation = 'SANGAT BAIK';
                appreciationIcon = '‚≠ê‚≠ê';
                statusClass = 'text-blue-600';
            } else if (percentage >= 70) {
                appreciation = 'BAIK - TUNTAS';
                appreciationIcon = '‚≠ê';
                statusClass = 'text-green-600';
            } else if (percentage >= 60) {
                appreciation = 'CUKUP BAIK';
                appreciationIcon = 'üëç';
                statusClass = 'text-orange-600';
            } else {
                appreciation = 'SEMANGAT BELAJAR TINGGI';
                appreciationIcon = 'üí™';
                statusClass = 'text-red-600';
            }
            
            // Store score for certificate
            currentStudent.gameScore = gameScore;
            currentStudent.gamePercentage = percentage;
            currentStudent.appreciation = appreciation;
            currentStudent.appreciationIcon = appreciationIcon;
            
            // Update completion message with appreciation
            const completionDiv = document.getElementById('gameComplete');
            completionDiv.innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-8 border-2 border-green-200">
                    <span class="text-6xl mb-4 block">üéâ</span>
                    <h3 class="text-3xl font-bold text-green-800 mb-4">Selamat!</h3>
                    <p class="text-xl text-green-700 mb-4">Kamu telah menyelesaikan evaluasi dengan skor <span class="font-bold">${gameScore}/20</span></p>
                    <div class="mb-6">
                        <div class="bg-white rounded-xl p-4 shadow-lg border-2 ${percentage >= 70 ? 'border-green-300' : 'border-orange-300'}">
                            <p class="text-lg font-semibold text-gray-700 mb-2">Persentase: <span class="text-2xl font-bold ${statusClass}">${percentage}%</span></p>
                            <p class="text-lg font-semibold text-gray-700 mb-2">Status: <span class="${statusClass}">${percentage >= 70 ? 'TUNTAS' : 'BELUM TUNTAS'}</span></p>
                            <p class="text-xl font-bold ${statusClass}">${appreciationIcon} ${appreciation}</p>
                            ${percentage < 70 ? '<p class="text-sm text-orange-600 mt-2">üí° Batas ketuntasan minimal: 70%. Silakan coba lagi!</p>' : ''}
                        </div>
                    </div>
                    <div class="flex gap-4 justify-center">
                        <button onclick="restartGame()" 
                                class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-blue-700 hover:to-indigo-700 transition duration-300">
                            üîÑ Coba Lagi
                        </button>
                        ${percentage >= 70 ? `
                        <button onclick="showTab('sertifikat')" 
                                class="bg-gradient-to-r from-yellow-600 to-orange-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-yellow-700 hover:to-orange-700 transition duration-300">
                            üèÜ Lihat Sertifikat
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('gameComplete').classList.remove('hidden');
            
            // Mark game as completed
            updateProgress('game');
        }

        function restartGame() {
            document.getElementById('gameArea').classList.remove('hidden');
            document.getElementById('gameComplete').classList.add('hidden');
            initGame();
        }

        // Canvas functionality
        function initCanvas() {
            // Initialize tracing canvas
            canvas = document.getElementById('drawingCanvas');
            backgroundCanvas = document.getElementById('backgroundCanvas');
            freeCanvas = document.getElementById('freeCanvas');
            
            if (canvas && backgroundCanvas) {
                ctx = canvas.getContext('2d');
                backgroundCtx = backgroundCanvas.getContext('2d');
                
                setupCanvas(canvas, ctx);
                setupCanvas(backgroundCanvas, backgroundCtx);
                
                // Draw initial ayat
                drawAyatBackground(currentAyat);
            }
            
            if (freeCanvas) {
                freeCtx = freeCanvas.getContext('2d');
                setupCanvas(freeCanvas, freeCtx);
            }
        }

        function setupCanvas(canvasElement, context) {
            // Set actual canvas size
            canvasElement.width = 1200;
            canvasElement.height = 800;
            
            context.lineCap = 'round';
            context.lineJoin = 'round';
            context.strokeStyle = currentColor;
            context.lineWidth = currentStroke;
            
            // Add event listeners only to drawing canvas
            if (canvasElement.id === 'drawingCanvas' || canvasElement.id === 'freeCanvas') {
                canvasElement.addEventListener('mousedown', startDrawing);
                canvasElement.addEventListener('mousemove', draw);
                canvasElement.addEventListener('mouseup', stopDrawing);
                canvasElement.addEventListener('mouseout', stopDrawing);
                
                canvasElement.addEventListener('touchstart', handleTouch);
                canvasElement.addEventListener('touchmove', handleTouch);
                canvasElement.addEventListener('touchend', stopDrawing);
            }
        }

        function drawAyatBackground(ayatNumber) {
            if (!backgroundCtx) return;
            
            backgroundCtx.clearRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
            
            const ayatTexts = {
                1: 'ŸàŸéÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê',
                2: 'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸíÿ•ŸêŸÜÿ≥ŸéÿßŸÜŸé ŸÑŸéŸÅŸêŸä ÿÆŸèÿ≥Ÿíÿ±Ÿç',
                3: 'ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß ŸàŸéÿπŸéŸÖŸêŸÑŸèŸàÿß ÿßŸÑÿµŸéŸëÿßŸÑŸêÿ≠Ÿéÿßÿ™Ÿê ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß ÿ®ŸêÿßŸÑŸíÿ≠ŸéŸÇŸêŸë ŸàŸéÿ™ŸéŸàŸéÿßÿµŸéŸàŸíÿß ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê'
            };
            
            const text = ayatTexts[ayatNumber];
            
            // Adjust font size based on canvas size and ayat length
            let fontSize;
            if (ayatNumber === 1) {
                fontSize = 120;
            } else if (ayatNumber === 2) {
                fontSize = 80;
            } else {
                fontSize = 50;
            }
            
            backgroundCtx.font = `${fontSize}px Amiri, serif`;
            backgroundCtx.textAlign = 'center';
            backgroundCtx.direction = 'rtl';
            
            const centerX = backgroundCanvas.width / 2;
            let centerY = backgroundCanvas.height / 2;
            
            // For ayat 3, split into multiple lines if needed
            if (ayatNumber === 3) {
                const words = text.split(' ');
                const lines = [];
                let currentLine = '';
                
                // Split long ayat into lines
                for (let i = 0; i < words.length; i++) {
                    const testLine = currentLine + words[i] + ' ';
                    const metrics = backgroundCtx.measureText(testLine);
                    
                    if (metrics.width > backgroundCanvas.width * 0.8 && currentLine !== '') {
                        lines.push(currentLine.trim());
                        currentLine = words[i] + ' ';
                    } else {
                        currentLine = testLine;
                    }
                }
                lines.push(currentLine.trim());
                
                // Draw each line
                const lineHeight = fontSize * 1.2;
                const startY = centerY - ((lines.length - 1) * lineHeight) / 2;
                
                lines.forEach((line, index) => {
                    const y = startY + (index * lineHeight);
                    
                    // Draw dashed outline for tracing
                    backgroundCtx.setLineDash([8, 8]);
                    backgroundCtx.strokeStyle = 'rgba(59, 130, 246, 0.6)';
                    backgroundCtx.lineWidth = 4;
                    backgroundCtx.strokeText(line, centerX, y);
                    
                    // Fill with very light color
                    backgroundCtx.setLineDash([]);
                    backgroundCtx.fillStyle = 'rgba(59, 130, 246, 0.15)';
                    backgroundCtx.fillText(line, centerX, y);
                });
            } else {
                // Single line ayat
                // Draw dashed outline for tracing
                backgroundCtx.setLineDash([10, 10]);
                backgroundCtx.strokeStyle = 'rgba(59, 130, 246, 0.6)';
                backgroundCtx.lineWidth = 5;
                backgroundCtx.strokeText(text, centerX, centerY);
                
                // Fill with very light color
                backgroundCtx.setLineDash([]);
                backgroundCtx.fillStyle = 'rgba(59, 130, 246, 0.15)';
                backgroundCtx.fillText(text, centerX, centerY);
            }
            
            // Add guidelines
            backgroundCtx.setLineDash([5, 15]);
            backgroundCtx.strokeStyle = 'rgba(156, 163, 175, 0.3)';
            backgroundCtx.lineWidth = 1;
            
            // Horizontal guidelines
            for (let i = 1; i <= 4; i++) {
                const y = (backgroundCanvas.height / 5) * i;
                backgroundCtx.beginPath();
                backgroundCtx.moveTo(50, y);
                backgroundCtx.lineTo(backgroundCanvas.width - 50, y);
                backgroundCtx.stroke();
            }
            
            backgroundCtx.setLineDash([]);
        }

        function startDrawing(e) {
            isDrawing = true;
            const activeCanvas = currentWritingMode === 'free' ? freeCanvas : canvas;
            const activeCtx = currentWritingMode === 'free' ? freeCtx : ctx;
            const rect = activeCanvas.getBoundingClientRect();
            
            // Calculate proper coordinates considering canvas scaling
            const scaleX = activeCanvas.width / rect.width;
            const scaleY = activeCanvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            activeCtx.beginPath();
            activeCtx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            const activeCanvas = currentWritingMode === 'free' ? freeCanvas : canvas;
            const activeCtx = currentWritingMode === 'free' ? freeCtx : ctx;
            const rect = activeCanvas.getBoundingClientRect();
            
            // Calculate proper coordinates considering canvas scaling
            const scaleX = activeCanvas.width / rect.width;
            const scaleY = activeCanvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            activeCtx.lineTo(x, y);
            activeCtx.stroke();
        }

        function stopDrawing() {
            if (isDrawing) {
                if (currentWritingMode === 'trace') {
                    // Mark current ayat as practiced
                    ayatProgress[currentAyat] = true;
                    updateAyatProgressDisplay();
                    
                    // Check if all ayats are completed
                    const allCompleted = Object.values(ayatProgress).every(Boolean);
                    if (allCompleted) {
                        updateProgress('latihan');
                        
                        // Show completion message
                        setTimeout(() => {
                            alert('üéâ Selamat! Anda telah menyelesaikan semua latihan menulis Surah Al-Ashr!\n\nSemua ayat telah berhasil dipraktikkan. Progress latihan Anda sudah lengkap.');
                        }, 500);
                    }
                } else {
                    // For free writing mode, mark as completed after some drawing
                    updateProgress('latihan');
                }
            }
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            const activeCanvas = currentWritingMode === 'free' ? freeCanvas : canvas;
            activeCanvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            const activeCtx = currentWritingMode === 'free' ? freeCtx : ctx;
            const activeCanvas = currentWritingMode === 'free' ? freeCanvas : canvas;
            if (activeCtx) {
                activeCtx.clearRect(0, 0, activeCanvas.width, activeCanvas.height);
            }
        }

        function changeColor(color) {
            currentColor = color;
            if (ctx) ctx.strokeStyle = color;
            if (freeCtx) freeCtx.strokeStyle = color;
        }

        function changeStroke(width) {
            currentStroke = width;
            if (ctx) ctx.lineWidth = width;
            if (freeCtx) freeCtx.lineWidth = width;
        }

        // Writing mode functions
        function setWritingMode(mode) {
            currentWritingMode = mode;
            
            // Update button styles
            document.getElementById('traceMode').className = mode === 'trace' ? 
                'px-6 py-3 rounded-xl font-bold transition duration-300 bg-blue-600 text-white' :
                'px-6 py-3 rounded-xl font-bold transition duration-300 text-gray-700 hover:bg-gray-200';
            
            document.getElementById('freeMode').className = mode === 'free' ? 
                'px-6 py-3 rounded-xl font-bold transition duration-300 bg-blue-600 text-white' :
                'px-6 py-3 rounded-xl font-bold transition duration-300 text-gray-700 hover:bg-gray-200';
            
            // Show/hide appropriate sections
            if (mode === 'trace') {
                document.getElementById('tracingExercise').classList.remove('hidden');
                document.getElementById('freeWriting').classList.add('hidden');
            } else {
                document.getElementById('tracingExercise').classList.add('hidden');
                document.getElementById('freeWriting').classList.remove('hidden');
            }
        }

        function selectAyat(ayatNumber) {
            currentAyat = ayatNumber;
            
            // Update button styles
            document.querySelectorAll('.ayat-btn').forEach(btn => {
                btn.className = 'ayat-btn px-4 py-2 rounded-lg font-bold text-blue-600 hover:bg-blue-50';
            });
            document.getElementById(`ayat${ayatNumber}Btn`).className = 'ayat-btn px-4 py-2 rounded-lg font-bold bg-blue-600 text-white';
            
            // Clear canvas and draw new background
            if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawAyatBackground(ayatNumber);
        }

        function updateAyatProgressDisplay() {
            for (let i = 1; i <= 3; i++) {
                const progressElement = document.getElementById(`ayat${i}Progress`);
                progressElement.textContent = ayatProgress[i] ? '‚úÖ' : '‚≠ï';
            }
        }

        // Video recording functions
        async function startRecording() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: true 
                });
                
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = function(event) {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = function() {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const videoURL = URL.createObjectURL(blob);
                    const videoElement = document.getElementById('recordedVideo');
                    videoElement.src = videoURL;
                    videoElement.classList.remove('hidden');
                    document.getElementById('uploadSection').classList.remove('hidden');
                };
                
                mediaRecorder.start();
                
                // Update UI
                document.getElementById('startBtn').disabled = true;
                document.getElementById('startBtn').className = 'bg-gradient-to-r from-gray-400 to-gray-500 text-white px-8 py-4 rounded-xl font-bold text-lg transition duration-300 shadow-lg';
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('stopBtn').className = 'bg-gradient-to-r from-red-500 to-red-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-red-600 hover:to-red-700 transition duration-300 shadow-lg';
                
                document.getElementById('recordIcon').textContent = 'üî¥';
                document.getElementById('recordStatus').textContent = 'Sedang merekam...';
                document.getElementById('recordingTimer').classList.remove('hidden');
                
                // Start timer
                recordingStartTime = Date.now();
                recordingTimer = setInterval(updateTimer, 1000);
                
            } catch (error) {
                alert('Tidak dapat mengakses kamera/mikrofon. Pastikan Anda memberikan izin akses.');
                console.error('Error accessing media devices:', error);
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                stream.getTracks().forEach(track => track.stop());
                
                // Update UI
                document.getElementById('startBtn').disabled = false;
                document.getElementById('startBtn').className = 'bg-gradient-to-r from-red-500 to-red-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:from-red-600 hover:to-red-700 transition duration-300 shadow-lg';
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('stopBtn').className = 'bg-gradient-to-r from-gray-400 to-gray-500 text-white px-8 py-4 rounded-xl font-bold text-lg transition duration-300 shadow-lg';
                
                document.getElementById('recordIcon').textContent = '‚úÖ';
                document.getElementById('recordStatus').textContent = 'Perekaman selesai';
                document.getElementById('recordingTimer').classList.add('hidden');
                
                clearInterval(recordingTimer);
            }
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Auto stop at 3 minutes
            if (elapsed >= 180) {
                stopRecording();
            }
        }

        async function submitVideo() {
            const title = document.getElementById('videoTitle').value || 'Video Bacaan Surah Al-Ashr';
            const notes = document.getElementById('videoNotes').value || '';
            const timestamp = new Date().toLocaleString('id-ID');
            
            // Show loading message
            const submitBtn = event.target;
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '‚è≥ Mengirim ke Google Drive...';
            submitBtn.disabled = true;
            
            try {
                // Get the recorded video blob
                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                
                // Check file size
                if (blob.size > GOOGLE_DRIVE_CONFIG.maxFileSize) {
                    throw new Error('File terlalu besar. Maksimal 50MB.');
                }
                
                // Create filename
                const fileName = `${currentStudent.name}_${currentStudent.class}_${Date.now()}.webm`;
                
                // Convert blob to base64
                const base64Data = await blobToBase64(blob);
                
                // Prepare upload data
                const uploadData = {
                    fileName: fileName,
                    fileData: base64Data,
                    folderId: GOOGLE_DRIVE_CONFIG.folderId,
                    metadata: {
                        title: title,
                        notes: notes,
                        student: currentStudent.name,
                        class: currentStudent.class,
                        timestamp: timestamp
                    }
                };
                
                // Upload to Google Drive via Google Apps Script
                const response = await fetch('https://script.google.com/macros/s/AKfycbxGoogleAppsScriptUploadEndpoint/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(uploadData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Store submission record with Google Drive info
                    const submission = {
                        title: title,
                        notes: notes,
                        timestamp: timestamp,
                        student: currentStudent.name,
                        class: currentStudent.class,
                        status: 'Terkirim ke Google Drive',
                        fileName: fileName,
                        fileId: result.fileId,
                        driveUrl: result.driveUrl
                    };
                    
                    submissionHistory.push(submission);
                    updateSubmissionHistory();
                    
                    // Mark video section as completed
                    updateProgress('video');
                    
                    // Show success message with file info
                    alert(`‚úÖ Video berhasil dikirim ke Google Drive!\n\nFile: ${fileName}\nFolder ID: ${GOOGLE_DRIVE_CONFIG.folderId}\n\nTugas video Anda telah selesai. Progress pembelajaran bertambah!\n\nGuru akan memberikan feedback dalam 1-2 hari kerja.`);
                    
                } else {
                    throw new Error(result.error || 'Gagal mengupload ke Google Drive');
                }
                
            } catch (error) {
                console.error('Upload error:', error);
                
                // Fallback: Store locally and show message
                const submission = {
                    title: title,
                    notes: notes,
                    timestamp: timestamp,
                    student: currentStudent.name,
                    class: currentStudent.class,
                    status: 'Tersimpan Lokal (Upload Gagal)',
                    error: error.message
                };
                
                submissionHistory.push(submission);
                updateSubmissionHistory();
                
                // Still mark as completed for progress
                updateProgress('video');
                
                alert(`‚ö†Ô∏è Upload ke Google Drive gagal: ${error.message}\n\nVideo tetap tersimpan secara lokal dan tugas dianggap selesai.\nSilakan coba upload manual atau hubungi guru.`);
            }
            
            // Reset form
            document.getElementById('videoTitle').value = '';
            document.getElementById('videoNotes').value = '';
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('recordedVideo').classList.add('hidden');
            document.getElementById('recordIcon').textContent = 'üé•';
            document.getElementById('recordStatus').textContent = 'Siap untuk merekam';
            
            // Reset button
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
        
        // Helper function to convert blob to base64
        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1]; // Remove data:video/webm;base64, prefix
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        // Video upload is now handled locally with simulation

        function retakeVideo() {
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('recordedVideo').classList.add('hidden');
            document.getElementById('recordIcon').textContent = 'üé•';
            document.getElementById('recordStatus').textContent = 'Siap untuk merekam';
        }

        function updateSubmissionHistory() {
            const historyContainer = document.getElementById('submissionHistory');
            
            if (submissionHistory.length === 0) {
                historyContainer.innerHTML = '<p class="text-blue-600 text-center italic">Belum ada video yang dikirim</p>';
                return;
            }
            
            historyContainer.innerHTML = submissionHistory.map((submission, index) => {
                const statusColor = submission.status.includes('Google Drive') ? 'bg-green-100 text-green-800' : 
                                  submission.status.includes('Gagal') ? 'bg-red-100 text-red-800' : 
                                  'bg-yellow-100 text-yellow-800';
                
                return `
                    <div class="bg-white rounded-xl p-4 shadow-lg border-l-4 ${submission.status.includes('Google Drive') ? 'border-green-500' : submission.status.includes('Gagal') ? 'border-red-500' : 'border-blue-500'}">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <h5 class="font-bold text-gray-800">${submission.title}</h5>
                                <p class="text-gray-600 text-sm">${submission.timestamp}</p>
                                ${submission.fileName ? `<p class="text-gray-700 text-xs mt-1">üìÅ ${submission.fileName}</p>` : ''}
                                ${submission.notes ? `<p class="text-gray-700 mt-2 text-sm">${submission.notes}</p>` : ''}
                                ${submission.error ? `<p class="text-red-600 text-xs mt-1">‚ùå ${submission.error}</p>` : ''}
                            </div>
                            <span class="${statusColor} px-3 py-1 rounded-full text-sm font-semibold whitespace-nowrap ml-2">${submission.status}</span>
                        </div>
                        ${submission.driveUrl ? `
                            <div class="mt-2 pt-2 border-t border-gray-200">
                                <p class="text-xs text-gray-600">üìÇ Folder ID: ${GOOGLE_DRIVE_CONFIG.folderId}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Video handling functions
        function checkVideoLoad() {
            const iframe = document.getElementById('youtubeVideo');
            const fallback = document.getElementById('videoFallback');
            
            // Set timeout to show fallback if video doesn't load
            setTimeout(() => {
                try {
                    // Check if iframe is accessible and loaded
                    if (!iframe.contentWindow) {
                        showVideoFallback();
                    }
                } catch (error) {
                    console.log('Video may be blocked, showing fallback');
                    showVideoFallback();
                }
            }, 5000);
        }
        
        function showVideoFallback() {
            const iframe = document.getElementById('youtubeVideo');
            const fallback = document.getElementById('videoFallback');
            
            iframe.style.display = 'none';
            fallback.classList.remove('hidden');
        }
        
        function retryVideo() {
            const iframe = document.getElementById('youtubeVideo');
            const fallback = document.getElementById('videoFallback');
            
            // Hide fallback and show iframe
            fallback.classList.add('hidden');
            iframe.style.display = 'block';
            
            // Reload iframe
            const currentSrc = iframe.src;
            iframe.src = '';
            setTimeout(() => {
                iframe.src = currentSrc;
            }, 100);
            
            // Check again after retry
            setTimeout(checkVideoLoad, 1000);
        }
        
        // Initialize video check when video tab is opened
        function initVideoTab() {
            setTimeout(checkVideoLoad, 1000);
        }

        function downloadCertificate() {
            // Create a temporary canvas for the certificate
            const certificateCanvas = document.createElement('canvas');
            const certificateCtx = certificateCanvas.getContext('2d');
            
            certificateCanvas.width = 1200;
            certificateCanvas.height = 800;
            
            // Fill with white background first (important for JPG)
            certificateCtx.fillStyle = '#ffffff';
            certificateCtx.fillRect(0, 0, 1200, 800);
            
            // Draw bright certificate background
            const gradient = certificateCtx.createLinearGradient(0, 0, 1200, 800);
            gradient.addColorStop(0, '#fef7cd');
            gradient.addColorStop(0.25, '#fef3c7');
            gradient.addColorStop(0.5, '#fed7aa');
            gradient.addColorStop(0.75, '#fde68a');
            gradient.addColorStop(1, '#fef7cd');
            certificateCtx.fillStyle = gradient;
            certificateCtx.fillRect(0, 0, 1200, 800);
            
            // Add golden border
            certificateCtx.strokeStyle = '#fbbf24';
            certificateCtx.lineWidth = 24;
            certificateCtx.strokeRect(12, 12, 1176, 776);
            
            // Inner border
            certificateCtx.strokeStyle = '#fcd34d';
            certificateCtx.lineWidth = 8;
            certificateCtx.strokeRect(40, 40, 1120, 720);
            
            // Add decorative corners
            certificateCtx.fillStyle = '#fbbf24';
            // Top left corner
            certificateCtx.beginPath();
            certificateCtx.arc(80, 80, 30, 0, 2 * Math.PI);
            certificateCtx.fill();
            // Top right corner
            certificateCtx.beginPath();
            certificateCtx.arc(1120, 80, 30, 0, 2 * Math.PI);
            certificateCtx.fill();
            // Bottom left corner
            certificateCtx.beginPath();
            certificateCtx.arc(80, 720, 30, 0, 2 * Math.PI);
            certificateCtx.fill();
            // Bottom right corner
            certificateCtx.beginPath();
            certificateCtx.arc(1120, 720, 30, 0, 2 * Math.PI);
            certificateCtx.fill();
            
            // Add trophy icon (simplified)
            certificateCtx.fillStyle = '#fbbf24';
            certificateCtx.font = '80px Arial';
            certificateCtx.textAlign = 'center';
            certificateCtx.fillText('üèÜ', 600, 100);
            
            // Add text
            certificateCtx.fillStyle = '#1e3a8a';
            certificateCtx.font = 'bold 48px Arial';
            certificateCtx.textAlign = 'center';
            certificateCtx.fillText('SERTIFIKAT', 600, 150);
            
            certificateCtx.font = '28px Arial';
            certificateCtx.fillText('Media Pembelajaran Al-Quran Hadits', 600, 190);
            
            // Decorative line
            certificateCtx.strokeStyle = '#fbbf24';
            certificateCtx.lineWidth = 4;
            certificateCtx.beginPath();
            certificateCtx.moveTo(450, 210);
            certificateCtx.lineTo(750, 210);
            certificateCtx.stroke();
            
            certificateCtx.font = '24px Arial';
            certificateCtx.fillText('Dengan bangga diberikan kepada:', 600, 250);
            
            // Student name box
            certificateCtx.fillStyle = 'rgba(251, 191, 36, 0.3)';
            certificateCtx.fillRect(300, 270, 600, 80);
            certificateCtx.strokeStyle = '#f59e0b';
            certificateCtx.lineWidth = 4;
            certificateCtx.strokeRect(300, 270, 600, 80);
            
            certificateCtx.fillStyle = '#1e3a8a';
            certificateCtx.font = 'bold 42px Arial';
            certificateCtx.fillText(currentStudent.name, 600, 320);
            
            certificateCtx.fillStyle = '#1e3a8a';
            certificateCtx.font = '24px Arial';
            certificateCtx.fillText(`Kelas: ${currentStudent.class}`, 600, 380);
            
            certificateCtx.fillText('Telah berhasil menyelesaikan pembelajaran', 600, 430);
            
            // Subject box
            certificateCtx.fillStyle = '#1e3a8a';
            certificateCtx.fillRect(350, 450, 500, 60);
            certificateCtx.fillStyle = '#ffffff';
            certificateCtx.font = 'bold 36px Arial';
            certificateCtx.fillText('SURAH AL-ASHR', 600, 490);
            
            certificateCtx.fillStyle = '#1e3a8a';
            certificateCtx.font = '28px Amiri, serif';
            certificateCtx.fillText('ÿ≥ŸèŸàÿ±Ÿéÿ©Ÿè ÿßŸÑŸíÿπŸéÿµŸíÿ±Ÿê', 600, 530);
            
            // Add appreciation based on game score with 70% minimum passing grade
            const score = currentStudent.gameScore || 0;
            const percentage = currentStudent.gamePercentage || 0;
            let appreciation = 'dengan prestasi yang membanggakan';
            let statusText = '';
            
            if (score > 0) {
                if (percentage >= 90) {
                    appreciation = 'dengan prestasi LUAR BIASA ‚≠ê‚≠ê‚≠ê';
                    statusText = 'TUNTAS - SANGAT MEMUASKAN';
                } else if (percentage >= 80) {
                    appreciation = 'dengan prestasi SANGAT BAIK ‚≠ê‚≠ê';
                    statusText = 'TUNTAS - MEMUASKAN';
                } else if (percentage >= 70) {
                    appreciation = 'dengan prestasi BAIK - TUNTAS ‚≠ê';
                    statusText = 'TUNTAS';
                } else if (percentage >= 60) {
                    appreciation = 'dengan prestasi CUKUP BAIK üëç';
                    statusText = 'BELUM TUNTAS - Perlu Perbaikan';
                } else {
                    appreciation = 'dengan semangat belajar yang tinggi üí™';
                    statusText = 'BELUM TUNTAS - Perlu Bimbingan';
                }
            }
            
            certificateCtx.font = '20px Arial';
            certificateCtx.fillText(appreciation, 600, 570);
            
            // Add score and status if game was completed
            if (score > 0) {
                certificateCtx.fillStyle = '#1e3a8a';
                certificateCtx.font = '18px Arial';
                certificateCtx.fillText(`Skor Evaluasi: ${score}/20 (${percentage}%)`, 600, 595);
                
                // Add status with color coding
                if (percentage >= 70) {
                    certificateCtx.fillStyle = '#10b981'; // Green for passing
                } else {
                    certificateCtx.fillStyle = '#f59e0b'; // Orange for not passing
                }
                certificateCtx.font = 'bold 16px Arial';
                certificateCtx.fillText(`Status: ${statusText}`, 600, 615);
                
                // Add minimum passing grade info
                certificateCtx.fillStyle = '#1e3a8a';
                certificateCtx.font = '14px Arial';
                certificateCtx.fillText('Batas Ketuntasan Minimal: 70%', 600, 635);
            }
            
            // Skip achievement icons section as requested
            
            certificateCtx.fillStyle = '#1e3a8a';
            certificateCtx.font = '20px Arial';
            certificateCtx.fillText(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 600, 680);
            
            // Signature lines
            certificateCtx.strokeStyle = '#1e3a8a';
            certificateCtx.lineWidth = 3;
            certificateCtx.beginPath();
            certificateCtx.moveTo(250, 740);
            certificateCtx.lineTo(450, 740);
            certificateCtx.stroke();
            
            certificateCtx.beginPath();
            certificateCtx.moveTo(750, 740);
            certificateCtx.lineTo(950, 740);
            certificateCtx.stroke();
            
            // Load and draw signature images
            const teacherSignature = new Image();
            const principalSignature = new Image();
            const schoolStamp = new Image();
            
            teacherSignature.crossOrigin = 'anonymous';
            principalSignature.crossOrigin = 'anonymous';
            schoolStamp.crossOrigin = 'anonymous';
            
            teacherSignature.src = 'https://i.imgur.com/Whpyn4a.png';
            principalSignature.src = 'https://i.imgur.com/TK6H4Ru.png';
            schoolStamp.src = 'https://i.imgur.com/PJIqaZq.png';
            
            // Wait for images to load and then draw them
            let imagesLoaded = 0;
            const totalImages = 3;
            
            function onImageLoad() {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    // Draw teacher signature
                    certificateCtx.drawImage(teacherSignature, 280, 680, 140, 50);
                    
                    // Draw principal signature
                    certificateCtx.drawImage(principalSignature, 780, 680, 140, 50);
                    
                    // Draw school stamp (overlapping left side of principal signature)
                    certificateCtx.drawImage(schoolStamp, 720, 650, 100, 100);
                    
                    // Add signature labels above signatures
                    certificateCtx.fillStyle = '#1e3a8a';
                    certificateCtx.font = 'bold 16px Arial';
                    certificateCtx.fillText('Guru Pengampu', 350, 650);
                    certificateCtx.fillText('Kepala Madrasah', 850, 650);
                    
                    certificateCtx.font = 'bold 18px Arial';
                    certificateCtx.fillText('MAHFUD SIDIK, S.Pd.I', 350, 760);
                    certificateCtx.fillText('MUSLIMAH, S.Pd.I', 850, 760);
                    
                    // Trigger download after images are drawn
                    finalizeCertificateDownload();
                }
            }
            
            teacherSignature.onload = onImageLoad;
            principalSignature.onload = onImageLoad;
            schoolStamp.onload = onImageLoad;
            
            // Fallback if images fail to load
            setTimeout(() => {
                if (imagesLoaded < totalImages) {
                    console.log('Some images failed to load, proceeding without them');
                    certificateCtx.fillStyle = '#1e3a8a';
                    certificateCtx.font = 'bold 18px Arial';
                    certificateCtx.fillText('Guru Pengampu', 350, 760);
                    certificateCtx.fillText('Kepala Madrasah', 850, 760);
                    
                    certificateCtx.font = '14px Arial';
                    certificateCtx.fillText('MAHFUD SIDIK, S.Pd.I', 350, 780);
                    certificateCtx.fillText('MUSLIMAH, S.Pd.I', 850, 780);
                    
                    finalizeCertificateDownload();
                }
            }, 5000);
            
            // Don't proceed with download here, wait for images
            
            // Function to finalize certificate download
            function finalizeCertificateDownload() {
                // Download as JPG
                const link = document.createElement('a');
                link.download = `Sertifikat_${currentStudent.name.replace(/\s+/g, '_')}_Surah_Al-Ashr.jpg`;
                link.href = certificateCanvas.toDataURL('image/jpeg', 0.95);
                link.click();
                
                // Show success message
                alert('‚úÖ Sertifikat berhasil diunduh!\n\nFile tersimpan sebagai JPG di folder Download Anda dengan tanda tangan resmi.');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96df27e4e61c5ff3',t:'MTc1NDk5MzE0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>
let recordedBlob = null;
let mediaRecorder;
let recordedChunks = [];

// Mulai perekaman
async function startRecording() {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    mediaRecorder = new MediaRecorder(stream);
    recordedChunks = [];

    mediaRecorder.ondataavailable = (e) => {
        if (e.data.size > 0) recordedChunks.push(e.data);
    };

    mediaRecorder.onstop = () => {
        recordedBlob = new Blob(recordedChunks, { type: 'video/webm' });
        const videoURL = URL.createObjectURL(recordedBlob);
        const videoEl = document.getElementById("recordedVideo");
        videoEl.src = videoURL;
        videoEl.classList.remove("hidden");
        document.getElementById("uploadSection").classList.remove("hidden");
    };

    mediaRecorder.start();
    document.getElementById("recordStatus").innerText = "üéôÔ∏è Sedang merekam...";
    document.getElementById("startBtn").disabled = true;
    document.getElementById("stopBtn").disabled = false;
}

// Stop perekaman
function stopRecording() {
    mediaRecorder.stop();
    document.getElementById("recordStatus").innerText = "‚úÖ Rekaman selesai";
    document.getElementById("startBtn").disabled = false;
    document.getElementById("stopBtn").disabled = true;
}

// Upload video ke Google Apps Script (Base64)
async function submitVideo() {
    if (!recordedBlob) {
        alert("‚ö†Ô∏è Tidak ada video untuk diupload!");
        return;
    }

    const base64Data = await blobToBase64(recordedBlob);
    const fileName = document.getElementById("videoTitle").value || "rekaman.webm";

    const payload = {
        file: base64Data.split(",")[1],
        filename: fileName,
        mimeType: recordedBlob.type || "video/webm"
    };

    try {
        await fetch(
            "https://script.google.com/macros/s/AKfycbwaGnPl7nZq6qzILmlnonxyVYsZeXFahhfDmmjivEA1r0kTlULN1bQuNoCs8xBeG5s2/exec",
            {
                method: "POST",
                body: new URLSearchParams(payload),
                mode: "no-cors"
            }
        );

        alert("‚úÖ Video berhasil dikirim (cek Google Drive untuk memastikan)");
        const history = document.getElementById("submissionHistory");
        history.innerHTML += `<p class="text-green-600">üì§ ${fileName} berhasil dikirim</p>`;

    } catch (error) {
        console.error(error);
        alert("‚ùå Terjadi kesalahan saat upload");
    }
}

// Helper konversi Blob ‚Üí Base64
function blobToBase64(blob) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
    });
}
</script>

</body>
</html>
